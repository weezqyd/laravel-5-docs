

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Database: Query Builder &mdash; Laravel 5 Documentation 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Laravel 5 Documentation 1.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Laravel 5 Documentation
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Database: Query Builder</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#retrieving-results">Retrieving Results</a><ul>
<li><a class="reference internal" href="#retrieving-all-rows-from-a-table">Retrieving All Rows From A Table</a></li>
<li><a class="reference internal" href="#retrieving-a-single-row-column-from-a-table">Retrieving A Single Row / Column From A Table</a></li>
<li><a class="reference internal" href="#chunking-results-from-a-table">Chunking Results From A Table</a></li>
<li><a class="reference internal" href="#retrieving-a-list-of-column-values">Retrieving A List Of Column Values</a></li>
<li><a class="reference internal" href="#aggregates">Aggregates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#selects">Selects</a><ul>
<li><a class="reference internal" href="#specifying-a-select-clause">Specifying A Select Clause</a></li>
<li><a class="reference internal" href="#raw-expressions">Raw Expressions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#joins">Joins</a><ul>
<li><a class="reference internal" href="#inner-join-statement">Inner Join Statement</a></li>
<li><a class="reference internal" href="#left-join-statement">Left Join Statement</a></li>
<li><a class="reference internal" href="#advanced-join-statements">Advanced Join Statements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unions">Unions</a></li>
<li><a class="reference internal" href="#where-clauses">Where Clauses</a><ul>
<li><a class="reference internal" href="#simple-where-clauses">Simple Where Clauses</a></li>
<li><a class="reference internal" href="#or-statements">Or Statements</a></li>
<li><a class="reference internal" href="#additional-where-clauses">Additional Where Clauses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-where-clauses">Advanced Where Clauses</a><ul>
<li><a class="reference internal" href="#parameter-grouping">Parameter Grouping</a></li>
<li><a class="reference internal" href="#exists-statements">Exists Statements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ordering-grouping-limit-offset">Ordering, Grouping, Limit, &amp; Offset</a><ul>
<li><a class="reference internal" href="#orderby">orderBy</a></li>
<li><a class="reference internal" href="#groupby-having-havingraw">groupBy / having / havingRaw</a></li>
<li><a class="reference internal" href="#skip-take">skip / take</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inserts">Inserts</a><ul>
<li><a class="reference internal" href="#auto-incrementing-ids">Auto-Incrementing IDs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updates">Updates</a><ul>
<li><a class="reference internal" href="#increment-decrement">Increment / Decrement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deletes">Deletes</a></li>
<li><a class="reference internal" href="#pessimistic-locking">Pessimistic Locking</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Laravel 5 Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Database: Query Builder</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/queries.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="database-query-builder">
<span id="database-query-builder"></span><h1>Database: Query Builder<a class="headerlink" href="#database-query-builder" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#retrieving-results">Retrieving Results</a><ul>
<li><a class="reference external" href="#aggregates">Aggregates</a></li>
</ul>
</li>
<li><a class="reference external" href="#selects">Selects</a></li>
<li><a class="reference external" href="#joins">Joins</a></li>
<li><a class="reference external" href="#unions">Unions</a></li>
<li><a class="reference external" href="#where-clauses">Where Clauses</a><ul>
<li><a class="reference external" href="#advanced-where-clauses">Advanced Where Clauses</a></li>
</ul>
</li>
<li><a class="reference external" href="#ordering-grouping-limit-and-offset">Ordering, Grouping, Limit, &amp; Offset</a></li>
<li><a class="reference external" href="#inserts">Inserts</a></li>
<li><a class="reference external" href="#updates">Updates</a></li>
<li><a class="reference external" href="#deletes">Deletes</a></li>
<li><a class="reference external" href="#pessimistic-locking">Pessimistic Locking</a></li>
</ul>
<p><a name="introduction"></a></p>
<div class="section" id="introduction">
<span id="introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The database query builder provides a convenient, fluent interface to creating and running database queries. It can be used to perform most database operations in your application, and works on all supported database systems.</p>
<blockquote>
<div><strong>Note:</strong> The Laravel query builder uses PDO parameter binding to protect your application against SQL injection attacks. There is no need to clean strings being passed as bindings.</div></blockquote>
<p><a name="retrieving-results"></a></p>
</div>
<div class="section" id="retrieving-results">
<span id="retrieving-results"></span><h2>Retrieving Results<a class="headerlink" href="#retrieving-results" title="Permalink to this headline">¶</a></h2>
<div class="section" id="retrieving-all-rows-from-a-table">
<span id="retrieving-all-rows-from-a-table"></span><h3>Retrieving All Rows From A Table<a class="headerlink" href="#retrieving-all-rows-from-a-table" title="Permalink to this headline">¶</a></h3>
<p>To begin a fluent query, use the <code class="docutils literal"><span class="pre">table</span></code> method on the <code class="docutils literal"><span class="pre">DB</span></code> facade. The <code class="docutils literal"><span class="pre">table</span></code> method returns a fluent query builder instance for the given table, allowing you to chain more constraints onto the query and then finally get the results. In this example, let&#8217;s just <code class="docutils literal"><span class="pre">get</span></code> all records from a table:</p>
<pre class="literal-block">
&lt;?php

namespace App\Http\Controllers;

use DB;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * Show a list of all of the application's users.
     *
     * &#64;return Response
     */
    public function index()
    {
        $users = DB::table('users')-&gt;get();

        return view('user.index', ['users' =&gt; $users]);
    }
}
</pre>
<p>Like <a class="reference external" href="/docs/{{version}}/database">raw queries</a>, the <code class="docutils literal"><span class="pre">get</span></code> method returns an <code class="docutils literal"><span class="pre">array</span></code> of results where each result is an instance of the PHP <code class="docutils literal"><span class="pre">StdClass</span></code> object. You may access each column&#8217;s value by accessing the column as a property of the object:</p>
<pre class="literal-block">
foreach ($users as $user) {
    echo $user-&gt;name;
}
</pre>
</div>
<div class="section" id="retrieving-a-single-row-column-from-a-table">
<span id="retrieving-a-single-row-column-from-a-table"></span><h3>Retrieving A Single Row / Column From A Table<a class="headerlink" href="#retrieving-a-single-row-column-from-a-table" title="Permalink to this headline">¶</a></h3>
<p>If you just need to retrieve a single row from the database table, you may use the <code class="docutils literal"><span class="pre">first</span></code> method. This method will return a single <code class="docutils literal"><span class="pre">StdClass</span></code> object:</p>
<pre class="literal-block">
$user = DB::table('users')-&gt;where('name', 'John')-&gt;first();

echo $user-&gt;name;
</pre>
<p>If you don&#8217;t even need an entire row, you may extract a single value from a record using the <code class="docutils literal"><span class="pre">value</span></code> method. This method will return the value of the column directly:</p>
<pre class="literal-block">
$email = DB::table('users')-&gt;where('name', 'John')-&gt;value('email');
</pre>
</div>
<div class="section" id="chunking-results-from-a-table">
<span id="chunking-results-from-a-table"></span><h3>Chunking Results From A Table<a class="headerlink" href="#chunking-results-from-a-table" title="Permalink to this headline">¶</a></h3>
<p>If you need to work with thousands of database records, consider using the <code class="docutils literal"><span class="pre">chunk</span></code> method. This method retrieves a small &#8220;chunk&#8221; of the results at a time, and feeds each chunk into a <code class="docutils literal"><span class="pre">Closure</span></code> for processing. This method is very useful for writing <a class="reference external" href="/docs/{{version}}/artisan">Artisan commands</a> that process thousands of records. For example, let&#8217;s work with the entire <code class="docutils literal"><span class="pre">users</span></code> table in chunks of 100 records at a time:</p>
<pre class="literal-block">
DB::table('users')-&gt;chunk(100, function($users) {
    foreach ($users as $user) {
        //
    }
});
</pre>
<p>You may stop further chunks from being processed by returning <code class="docutils literal"><span class="pre">false</span></code> from the <code class="docutils literal"><span class="pre">Closure</span></code>:</p>
<pre class="literal-block">
DB::table('users')-&gt;chunk(100, function($users) {
    // Process the records...

    return false;
});
</pre>
</div>
<div class="section" id="retrieving-a-list-of-column-values">
<span id="retrieving-a-list-of-column-values"></span><h3>Retrieving A List Of Column Values<a class="headerlink" href="#retrieving-a-list-of-column-values" title="Permalink to this headline">¶</a></h3>
<p>If you would like to retrieve an array containing the values of a single column, you may use the <code class="docutils literal"><span class="pre">lists</span></code> method. In this example, we&#8217;ll retrieve an array of role titles:</p>
<pre class="literal-block">
$titles = DB::table('roles')-&gt;lists('title');

foreach ($titles as $title) {
    echo $title;
}
</pre>
<p>You may also specify a custom key column for the returned array:</p>
<pre class="literal-block">
$roles = DB::table('roles')-&gt;lists('title', 'name');

foreach ($roles as $name =&gt; $title) {
    echo $title;
}
</pre>
<p><a name="aggregates"></a></p>
</div>
<div class="section" id="aggregates">
<span id="aggregates"></span><h3>Aggregates<a class="headerlink" href="#aggregates" title="Permalink to this headline">¶</a></h3>
<p>The query builder also provides a variety of aggregate methods, such as <code class="docutils literal"><span class="pre">count</span></code>, <code class="docutils literal"><span class="pre">max</span></code>, <code class="docutils literal"><span class="pre">min</span></code>, <code class="docutils literal"><span class="pre">avg</span></code>, and <code class="docutils literal"><span class="pre">sum</span></code>. You may call any of these methods after constructing your query:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;count();

$price = DB::table('orders')-&gt;max('price');
</pre>
<p>Of course, you may combine these methods with other clauses to build your query:</p>
<pre class="literal-block">
$price = DB::table('orders')
                -&gt;where('finalized', 1)
                -&gt;avg('price');
</pre>
<p><a name="selects"></a></p>
</div>
</div>
<div class="section" id="selects">
<span id="selects"></span><h2>Selects<a class="headerlink" href="#selects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="specifying-a-select-clause">
<span id="specifying-a-select-clause"></span><h3>Specifying A Select Clause<a class="headerlink" href="#specifying-a-select-clause" title="Permalink to this headline">¶</a></h3>
<p>Of course, you may not always want to select all columns from a database table. Using the <code class="docutils literal"><span class="pre">select</span></code> method, you can specify a custom <code class="docutils literal"><span class="pre">select</span></code> clause for the query:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;select('name', 'email as user_email')-&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">distinct</span></code> method allows you to force the query to return distinct results:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;distinct()-&gt;get();
</pre>
<p>If you already have a query builder instance and you wish to add a column to its existing select clause, you may use the <code class="docutils literal"><span class="pre">addSelect</span></code> method:</p>
<pre class="literal-block">
$query = DB::table('users')-&gt;select('name');

$users = $query-&gt;addSelect('age')-&gt;get();
</pre>
</div>
<div class="section" id="raw-expressions">
<span id="raw-expressions"></span><h3>Raw Expressions<a class="headerlink" href="#raw-expressions" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may need to use a raw expression in a query. These expressions will be injected into the query as strings, so be careful not to create any SQL injection points! To create a raw expression, you may use the <code class="docutils literal"><span class="pre">DB::raw</span></code> method:</p>
<pre class="literal-block">
$users = DB::table('users')
                     -&gt;select(DB::raw('count(*) as user_count, status'))
                     -&gt;where('status', '&lt;&gt;', 1)
                     -&gt;groupBy('status')
                     -&gt;get();
</pre>
<p><a name="joins"></a></p>
</div>
</div>
<div class="section" id="joins">
<span id="joins"></span><h2>Joins<a class="headerlink" href="#joins" title="Permalink to this headline">¶</a></h2>
<div class="section" id="inner-join-statement">
<span id="inner-join-statement"></span><h3>Inner Join Statement<a class="headerlink" href="#inner-join-statement" title="Permalink to this headline">¶</a></h3>
<p>The query builder may also be used to write join statements. To perform a basic SQL &#8220;inner join&#8221;, you may use the <code class="docutils literal"><span class="pre">join</span></code> method on a query builder instance. The first argument passed to the <code class="docutils literal"><span class="pre">join</span></code> method is the name of the table you need to join to, while the remaining arguments specify the column constraints for the join. Of course, as you can see, you can join to multiple tables in a single query:</p>
<pre class="literal-block">
$users = DB::table('users')
            -&gt;join('contacts', 'users.id', '=', 'contacts.user_id')
            -&gt;join('orders', 'users.id', '=', 'orders.user_id')
            -&gt;select('users.*', 'contacts.phone', 'orders.price')
            -&gt;get();
</pre>
</div>
<div class="section" id="left-join-statement">
<span id="left-join-statement"></span><h3>Left Join Statement<a class="headerlink" href="#left-join-statement" title="Permalink to this headline">¶</a></h3>
<p>If you would like to perform a &#8220;left join&#8221; instead of an &#8220;inner join&#8221;, use the <code class="docutils literal"><span class="pre">leftJoin</span></code> method. The <code class="docutils literal"><span class="pre">leftJoin</span></code> method has the same signature as the <code class="docutils literal"><span class="pre">join</span></code> method:</p>
<pre class="literal-block">
$users = DB::table('users')
            -&gt;leftJoin('posts', 'users.id', '=', 'posts.user_id')
            -&gt;get();
</pre>
</div>
<div class="section" id="advanced-join-statements">
<span id="advanced-join-statements"></span><h3>Advanced Join Statements<a class="headerlink" href="#advanced-join-statements" title="Permalink to this headline">¶</a></h3>
<p>You may also specify more advanced join clauses. To get started, pass a <code class="docutils literal"><span class="pre">Closure</span></code> as the second argument into the <code class="docutils literal"><span class="pre">join</span></code> method. The <code class="docutils literal"><span class="pre">Closure</span></code> will receive a <code class="docutils literal"><span class="pre">JoinClause</span></code> object which allows you to specify constraints on the <code class="docutils literal"><span class="pre">join</span></code> clause:</p>
<pre class="literal-block">
DB::table('users')
        -&gt;join('contacts', function ($join) {
            $join-&gt;on('users.id', '=', 'contacts.user_id')-&gt;orOn(...);
        })
        -&gt;get();
</pre>
<p>If you would like to use a &#8220;where&#8221; style clause on your joins, you may use the <code class="docutils literal"><span class="pre">where</span></code> and <code class="docutils literal"><span class="pre">orWhere</span></code> methods on a join. Instead of comparing two columns, these methods will compare the column against a value:</p>
<pre class="literal-block">
DB::table('users')
        -&gt;join('contacts', function ($join) {
            $join-&gt;on('users.id', '=', 'contacts.user_id')
                 -&gt;where('contacts.user_id', '&gt;', 5);
        })
        -&gt;get();
</pre>
<p><a name="unions"></a></p>
</div>
</div>
<div class="section" id="unions">
<span id="unions"></span><h2>Unions<a class="headerlink" href="#unions" title="Permalink to this headline">¶</a></h2>
<p>The query builder also provides a quick way to &#8220;union&#8221; two queries together. For example, you may create an initial query, and then use the <code class="docutils literal"><span class="pre">union</span></code> method to union it with a second query:</p>
<pre class="literal-block">
$first = DB::table('users')
            -&gt;whereNull('first_name');

$users = DB::table('users')
            -&gt;whereNull('last_name')
            -&gt;union($first)
            -&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">unionAll</span></code> method is also available and has the same method signature as <code class="docutils literal"><span class="pre">union</span></code>.</p>
<p><a name="where-clauses"></a></p>
</div>
<div class="section" id="where-clauses">
<span id="where-clauses"></span><h2>Where Clauses<a class="headerlink" href="#where-clauses" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simple-where-clauses">
<span id="simple-where-clauses"></span><h3>Simple Where Clauses<a class="headerlink" href="#simple-where-clauses" title="Permalink to this headline">¶</a></h3>
<p>To add <code class="docutils literal"><span class="pre">where</span></code> clauses to the query, use the <code class="docutils literal"><span class="pre">where</span></code> method on a query builder instance. The most basic call to <code class="docutils literal"><span class="pre">where</span></code> requires three arguments. The first argument is the name of the column. The second argument is an operator, which can be any of the database&#8217;s supported operators. The third argument is the value to evaluate against the column.</p>
<p>For example, here is a query that verifies the value of the &#8220;votes&#8221; column is equal to 100:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;where('votes', '=', 100)-&gt;get();
</pre>
<p>For convenience, if you simply want to verify that a column is equal to a given value, you may pass the value directly as the second argument to the <code class="docutils literal"><span class="pre">where</span></code> method:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;where('votes', 100)-&gt;get();
</pre>
<p>Of course, you may use a variety of other operators when writing a <code class="docutils literal"><span class="pre">where</span></code> clause:</p>
<pre class="literal-block">
$users = DB::table('users')
                -&gt;where('votes', '&gt;=', 100)
                -&gt;get();

$users = DB::table('users')
                -&gt;where('votes', '&lt;&gt;', 100)
                -&gt;get();

$users = DB::table('users')
                -&gt;where('name', 'like', 'T%')
                -&gt;get();
</pre>
</div>
<div class="section" id="or-statements">
<span id="or-statements"></span><h3>Or Statements<a class="headerlink" href="#or-statements" title="Permalink to this headline">¶</a></h3>
<p>You may chain where constraints together, as well as add <code class="docutils literal"><span class="pre">or</span></code> clauses to the query. The <code class="docutils literal"><span class="pre">orWhere</span></code> method accepts the same arguments as the <code class="docutils literal"><span class="pre">where</span></code> method:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;where('votes', '&gt;', 100)
                    -&gt;orWhere('name', 'John')
                    -&gt;get();
</pre>
</div>
<div class="section" id="additional-where-clauses">
<span id="additional-where-clauses"></span><h3>Additional Where Clauses<a class="headerlink" href="#additional-where-clauses" title="Permalink to this headline">¶</a></h3>
<p><strong>whereBetween</strong></p>
<p>The <code class="docutils literal"><span class="pre">whereBetween</span></code> method verifies that a column&#8217;s value is between two values:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereBetween('votes', [1, 100])-&gt;get();
</pre>
<p><strong>whereNotBetween</strong></p>
<p>The <code class="docutils literal"><span class="pre">whereNotBetween</span></code> method verifies that a column&#8217;s value lies outside of two values:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereNotBetween('votes', [1, 100])
                    -&gt;get();
</pre>
<p><strong>whereIn / whereNotIn</strong></p>
<p>The <code class="docutils literal"><span class="pre">whereIn</span></code> method verifies that a given column&#8217;s value is contained within the given array:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereIn('id', [1, 2, 3])
                    -&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">whereNotIn</span></code> method verifies that the given column&#8217;s value is <strong>not</strong> contained in the given array:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereNotIn('id', [1, 2, 3])
                    -&gt;get();
</pre>
<p><strong>whereNull / whereNotNull</strong></p>
<p>The <code class="docutils literal"><span class="pre">whereNull</span></code> method verifies that the value of the given column is <code class="docutils literal"><span class="pre">NULL</span></code>:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereNull('updated_at')
                    -&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">whereNotNull</span></code> method verifies that the column&#8217;s value is <strong>not</strong> <code class="docutils literal"><span class="pre">NULL</span></code>:</p>
<pre class="literal-block">
$users = DB::table('users')
                    -&gt;whereNotNull('updated_at')
                    -&gt;get();
</pre>
<p><a name="advanced-where-clauses"></a></p>
</div>
</div>
<div class="section" id="advanced-where-clauses">
<span id="advanced-where-clauses"></span><h2>Advanced Where Clauses<a class="headerlink" href="#advanced-where-clauses" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parameter-grouping">
<span id="parameter-grouping"></span><h3>Parameter Grouping<a class="headerlink" href="#parameter-grouping" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may need to create more advanced where clauses such as &#8220;where exists&#8221; or nested parameter groupings. The Laravel query builder can handle these as well. To get started, let&#8217;s look at an example of grouping constraints within parenthesis:</p>
<pre class="literal-block">
DB::table('users')
            -&gt;where('name', '=', 'John')
            -&gt;orWhere(function ($query) {
                $query-&gt;where('votes', '&gt;', 100)
                      -&gt;where('title', '&lt;&gt;', 'Admin');
            })
            -&gt;get();
</pre>
<p>As you can see, passing <code class="docutils literal"><span class="pre">Closure</span></code> into the <code class="docutils literal"><span class="pre">orWhere</span></code> method instructs the query builder to begin a constraint group. The <code class="docutils literal"><span class="pre">Closure</span></code> will receive a query builder instance which you can use to set the constraints that should be contained within the parenthesis group. The example above will produce the following SQL:</p>
<pre class="literal-block">
select * from users where name = 'John' or (votes &gt; 100 and title &lt;&gt; 'Admin')
</pre>
</div>
<div class="section" id="exists-statements">
<span id="exists-statements"></span><h3>Exists Statements<a class="headerlink" href="#exists-statements" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">whereExists</span></code> method allows you to write <code class="docutils literal"><span class="pre">where</span> <span class="pre">exist</span></code> SQL clauses. The <code class="docutils literal"><span class="pre">whereExists</span></code> method accepts a <code class="docutils literal"><span class="pre">Closure</span></code> argument, which will receive a query builder instance allowing you to define the query that should be placed inside of the &#8220;exists&#8221; clause:</p>
<pre class="literal-block">
DB::table('users')
            -&gt;whereExists(function ($query) {
                $query-&gt;select(DB::raw(1))
                      -&gt;from('orders')
                      -&gt;whereRaw('orders.user_id = users.id');
            })
            -&gt;get();
</pre>
<p>The query above will produce the following SQL:</p>
<pre class="literal-block">
select * from users
where exists (
    select 1 from orders where orders.user_id = users.id
)
</pre>
<p><a name="ordering-grouping-limit-and-offset"></a></p>
</div>
</div>
<div class="section" id="ordering-grouping-limit-offset">
<span id="ordering-grouping-limit-offset"></span><h2>Ordering, Grouping, Limit, &amp; Offset<a class="headerlink" href="#ordering-grouping-limit-offset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="orderby">
<span id="orderby"></span><h3>orderBy<a class="headerlink" href="#orderby" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">orderBy</span></code> method allows you to sort the result of the query by a given column. The first argument to the <code class="docutils literal"><span class="pre">orderBy</span></code> method should be the column you wish to sort by, while the second argument controls the direction of the sort and may be either <code class="docutils literal"><span class="pre">asc</span></code> or <code class="docutils literal"><span class="pre">desc</span></code>:</p>
<pre class="literal-block">
$users = DB::table('users')
                -&gt;orderBy('name', 'desc')
                -&gt;get();
</pre>
</div>
<div class="section" id="groupby-having-havingraw">
<span id="groupby-having-havingraw"></span><h3>groupBy / having / havingRaw<a class="headerlink" href="#groupby-having-havingraw" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">groupBy</span></code> and <code class="docutils literal"><span class="pre">having</span></code> methods may be used to group the query results. The <code class="docutils literal"><span class="pre">having</span></code> method&#8217;s signature is similar to that of the <code class="docutils literal"><span class="pre">where</span></code> method:</p>
<pre class="literal-block">
$users = DB::table('users')
                -&gt;groupBy('account_id')
                -&gt;having('account_id', '&gt;', 100)
                -&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">havingRaw</span></code> method may be used to set a raw string as the value of the <code class="docutils literal"><span class="pre">having</span></code> clause. For example, we can find all of the departments with sales greater than $2,500:</p>
<pre class="literal-block">
$users = DB::table('orders')
                -&gt;select('department', DB::raw('SUM(price) as total_sales'))
                -&gt;groupBy('department')
                -&gt;havingRaw('SUM(price) &gt; 2500')
                -&gt;get();
</pre>
</div>
<div class="section" id="skip-take">
<span id="skip-take"></span><h3>skip / take<a class="headerlink" href="#skip-take" title="Permalink to this headline">¶</a></h3>
<p>To limit the number of results returned from the query, or to skip a given number of results in the query (<code class="docutils literal"><span class="pre">OFFSET</span></code>), you may use the <code class="docutils literal"><span class="pre">skip</span></code> and <code class="docutils literal"><span class="pre">take</span></code> methods:</p>
<pre class="literal-block">
$users = DB::table('users')-&gt;skip(10)-&gt;take(5)-&gt;get();
</pre>
<p><a name="inserts"></a></p>
</div>
</div>
<div class="section" id="inserts">
<span id="inserts"></span><h2>Inserts<a class="headerlink" href="#inserts" title="Permalink to this headline">¶</a></h2>
<p>The query builder also provides an <code class="docutils literal"><span class="pre">insert</span></code> method for inserting records into the database table. The <code class="docutils literal"><span class="pre">insert</span></code> method accepts an array of column names and values to insert:</p>
<pre class="literal-block">
DB::table('users')-&gt;insert(
    ['email' =&gt; 'john&#64;example.com', 'votes' =&gt; 0]
);
</pre>
<p>You may even insert several records into the table with a single call to <code class="docutils literal"><span class="pre">insert</span></code> by passing an array of arrays. Each array represents a row to be inserted into the table:</p>
<pre class="literal-block">
DB::table('users')-&gt;insert([
    ['email' =&gt; 'taylor&#64;example.com', 'votes' =&gt; 0],
    ['email' =&gt; 'dayle&#64;example.com', 'votes' =&gt; 0]
]);
</pre>
<div class="section" id="auto-incrementing-ids">
<span id="auto-incrementing-ids"></span><h3>Auto-Incrementing IDs<a class="headerlink" href="#auto-incrementing-ids" title="Permalink to this headline">¶</a></h3>
<p>If the table has an auto-incrementing id, use the <code class="docutils literal"><span class="pre">insertGetId</span></code> method to insert a record and then retrieve the ID:</p>
<pre class="literal-block">
$id = DB::table('users')-&gt;insertGetId(
    ['email' =&gt; 'john&#64;example.com', 'votes' =&gt; 0]
);
</pre>
<blockquote>
<div><strong>Note:</strong> When using PostgreSQL the insertGetId method expects the auto-incrementing column to be named <code class="docutils literal"><span class="pre">id</span></code>. If you would like to retrieve the ID from a different &#8220;sequence&#8221;, you may pass the sequence name as the second parameter to the <code class="docutils literal"><span class="pre">insertGetId</span></code> method.</div></blockquote>
<p><a name="updates"></a></p>
</div>
</div>
<div class="section" id="updates">
<span id="updates"></span><h2>Updates<a class="headerlink" href="#updates" title="Permalink to this headline">¶</a></h2>
<p>Of course, in addition to inserting records into the database, the query builder can also update existing records using the <code class="docutils literal"><span class="pre">update</span></code> method. The <code class="docutils literal"><span class="pre">update</span></code> method, like the <code class="docutils literal"><span class="pre">insert</span></code> method, accepts an array of column and value pairs containing the columns to be updated. You may constrain the <code class="docutils literal"><span class="pre">update</span></code> query using <code class="docutils literal"><span class="pre">where</span></code> clauses:</p>
<pre class="literal-block">
DB::table('users')
            -&gt;where('id', 1)
            -&gt;update(['votes' =&gt; 1]);
</pre>
<div class="section" id="increment-decrement">
<span id="increment-decrement"></span><h3>Increment / Decrement<a class="headerlink" href="#increment-decrement" title="Permalink to this headline">¶</a></h3>
<p>The query builder also provides convenient methods for incrementing or decrementing the value of a given column. This is simply a short-cut, providing a more expressive and terse interface compared to manually writing the <code class="docutils literal"><span class="pre">update</span></code> statement.</p>
<p>Both of these methods accept at least one argument: the column to modify. A second argument may optionally be passed to control the amount by which the column should be incremented / decremented.</p>
<pre class="literal-block">
DB::table('users')-&gt;increment('votes');

DB::table('users')-&gt;increment('votes', 5);

DB::table('users')-&gt;decrement('votes');

DB::table('users')-&gt;decrement('votes', 5);
</pre>
<p>You may also specify additional columns to update during the operation:</p>
<pre class="literal-block">
DB::table('users')-&gt;increment('votes', 1, ['name' =&gt; 'John']);
</pre>
<p><a name="deletes"></a></p>
</div>
</div>
<div class="section" id="deletes">
<span id="deletes"></span><h2>Deletes<a class="headerlink" href="#deletes" title="Permalink to this headline">¶</a></h2>
<p>Of course, the query builder may also be used to delete records from the table via the <code class="docutils literal"><span class="pre">delete</span></code> method:</p>
<pre class="literal-block">
DB::table('users')-&gt;delete();
</pre>
<p>You may constrain <code class="docutils literal"><span class="pre">delete</span></code> statements by adding <code class="docutils literal"><span class="pre">where</span></code> clauses before calling the <code class="docutils literal"><span class="pre">delete</span></code> method:</p>
<pre class="literal-block">
DB::table('users')-&gt;where('votes', '&lt;', 100)-&gt;delete();
</pre>
<p>If you wish to truncate the entire table, which will remove all rows and reset the auto-incrementing ID to zero, you may use the <code class="docutils literal"><span class="pre">truncate</span></code> method:</p>
<pre class="literal-block">
DB::table('users')-&gt;truncate();
</pre>
<p><a name="pessimistic-locking"></a></p>
</div>
<div class="section" id="pessimistic-locking">
<span id="pessimistic-locking"></span><h2>Pessimistic Locking<a class="headerlink" href="#pessimistic-locking" title="Permalink to this headline">¶</a></h2>
<p>The query builder also includes a few functions to help you do &#8220;pessimistic locking&#8221; on your <code class="docutils literal"><span class="pre">select</span></code> statements. To run the statement with a &#8220;shared lock&#8221;, you may use the <code class="docutils literal"><span class="pre">sharedLock</span></code> method on a query. A shared lock prevents the selected rows from being modified until your transaction commits:</p>
<pre class="literal-block">
DB::table('users')-&gt;where('votes', '&gt;', 100)-&gt;sharedLock()-&gt;get();
</pre>
<p>Alternatively, you may use the <code class="docutils literal"><span class="pre">lockForUpdate</span></code> method. A &#8220;for update&#8221; lock prevents the rows from being modified or from being selected with another shared lock:</p>
<pre class="literal-block">
DB::table('users')-&gt;where('votes', '&gt;', 100)-&gt;lockForUpdate()-&gt;get();
</pre>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, The Weezqyd.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>