

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Eloquent: Getting Started &mdash; Laravel 5 Documentation 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Laravel 5 Documentation 1.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Laravel 5 Documentation
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Eloquent: Getting Started</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#defining-models">Defining Models</a><ul>
<li><a class="reference internal" href="#eloquent-model-conventions">Eloquent Model Conventions</a><ul>
<li><a class="reference internal" href="#table-names">Table Names</a></li>
<li><a class="reference internal" href="#primary-keys">Primary Keys</a></li>
<li><a class="reference internal" href="#timestamps">Timestamps</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#retrieving-multiple-models">Retrieving Multiple Models</a><ul>
<li><a class="reference internal" href="#accessing-column-values">Accessing Column Values</a></li>
<li><a class="reference internal" href="#adding-additional-constraints">Adding Additional Constraints</a></li>
<li><a class="reference internal" href="#collections">Collections</a></li>
<li><a class="reference internal" href="#chunking-results">Chunking Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retrieving-single-models-aggregates">Retrieving Single Models / Aggregates</a><ul>
<li><a class="reference internal" href="#not-found-exceptions">Not Found Exceptions</a></li>
<li><a class="reference internal" href="#retrieving-aggregates">Retrieving Aggregates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inserting-updating-models">Inserting &amp; Updating Models</a><ul>
<li><a class="reference internal" href="#basic-inserts">Basic Inserts</a></li>
<li><a class="reference internal" href="#basic-updates">Basic Updates</a></li>
<li><a class="reference internal" href="#mass-assignment">Mass Assignment</a><ul>
<li><a class="reference internal" href="#other-creation-methods">Other Creation Methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#deleting-models">Deleting Models</a><ul>
<li><a class="reference internal" href="#deleting-an-existing-model-by-key">Deleting An Existing Model By Key</a></li>
<li><a class="reference internal" href="#deleting-models-by-query">Deleting Models By Query</a></li>
<li><a class="reference internal" href="#soft-deleting">Soft Deleting</a></li>
<li><a class="reference internal" href="#querying-soft-deleted-models">Querying Soft Deleted Models</a><ul>
<li><a class="reference internal" href="#including-soft-deleted-models">Including Soft Deleted Models</a></li>
<li><a class="reference internal" href="#retrieving-only-soft-deleted-models">Retrieving Only Soft Deleted Models</a></li>
<li><a class="reference internal" href="#restoring-soft-deleted-models">Restoring Soft Deleted Models</a></li>
<li><a class="reference internal" href="#permanently-deleting-models">Permanently Deleting Models</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#query-scopes">Query Scopes</a><ul>
<li><a class="reference internal" href="#utilizing-a-query-scope">Utilizing A Query Scope</a></li>
<li><a class="reference internal" href="#dynamic-scopes">Dynamic Scopes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#events">Events</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Laravel 5 Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Eloquent: Getting Started</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/eloquent.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="eloquent-getting-started">
<span id="eloquent-getting-started"></span><h1>Eloquent: Getting Started<a class="headerlink" href="#eloquent-getting-started" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#defining-models">Defining Models</a><ul>
<li><a class="reference external" href="#eloquent-model-conventions">Eloquent Model Conventions</a></li>
</ul>
</li>
<li><a class="reference external" href="#retrieving-multiple-models">Retrieving Multiple Models</a></li>
<li><a class="reference external" href="#retrieving-single-models">Retrieving Single Models / Aggregates</a><ul>
<li><a class="reference external" href="#retrieving-aggregates">Retrieving Aggregates</a></li>
</ul>
</li>
<li><a class="reference external" href="#inserting-and-updating-models">Inserting &amp; Updating Models</a><ul>
<li><a class="reference external" href="#basic-inserts">Basic Inserts</a></li>
<li><a class="reference external" href="#basic-updates">Basic Updates</a></li>
<li><a class="reference external" href="#mass-assignment">Mass Assignment</a></li>
</ul>
</li>
<li><a class="reference external" href="#deleting-models">Deleting Models</a><ul>
<li><a class="reference external" href="#soft-deleting">Soft Deleting</a></li>
<li><a class="reference external" href="#querying-soft-deleted-models">Querying Soft Deleted Models</a></li>
</ul>
</li>
<li><a class="reference external" href="#query-scopes">Query Scopes</a></li>
<li><a class="reference external" href="#events">Events</a></li>
</ul>
<p><a name="introduction"></a></p>
<div class="section" id="introduction">
<span id="introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &#8220;Model&#8221; which is used to interact with that table. Models allow you to query for data in your tables, as well as insert new records into the table.</p>
<p>Before getting started, be sure to configure a database connection in <code class="docutils literal"><span class="pre">config/database.php</span></code>. For more information on configuring your database, check out <a class="reference external" href="database.html#configuration">the documentation</a>.</p>
<p><a name="defining-models"></a></p>
</div>
<div class="section" id="defining-models">
<span id="defining-models"></span><h2>Defining Models<a class="headerlink" href="#defining-models" title="Permalink to this headline">¶</a></h2>
<p>To get started, let&#8217;s create an Eloquent model. Models typically live in the <code class="docutils literal"><span class="pre">app</span></code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code class="docutils literal"><span class="pre">composer.json</span></code> file. All Eloquent models extend <code class="docutils literal"><span class="pre">Illuminate\Database\Eloquent\Model</span></code> class.</p>
<p>The easiest way to create a model instance is using the <code class="docutils literal"><span class="pre">make:model</span></code> <a class="reference external" href="artisan.html">Artisan command</a>:</p>
<pre class="literal-block">
php artisan make:model User
</pre>
<p>If you would like to generate a <a class="reference external" href="migrations.html">database migration</a> when you generate the model, you may use the <code class="docutils literal"><span class="pre">--migration</span></code> or <code class="docutils literal"><span class="pre">-m</span></code> option:</p>
<pre class="literal-block">
php artisan make:model User --migration

php artisan make:model User -m
</pre>
<p><a name="eloquent-model-conventions"></a></p>
<div class="section" id="eloquent-model-conventions">
<span id="eloquent-model-conventions"></span><h3>Eloquent Model Conventions<a class="headerlink" href="#eloquent-model-conventions" title="Permalink to this headline">¶</a></h3>
<p>Now, let&#8217;s look at an example <code class="docutils literal"><span class="pre">Flight</span></code> model class, which we will use to retrieve and store information from our <code class="docutils literal"><span class="pre">flights</span></code> database table:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    //
}
</pre>
<div class="section" id="table-names">
<span id="table-names"></span><h4>Table Names<a class="headerlink" href="#table-names" title="Permalink to this headline">¶</a></h4>
<p>Note that we did not tell Eloquent which table to use for our <code class="docutils literal"><span class="pre">Flight</span></code> model. The &#8220;snake case&#8221;, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Eloquent will assume the <code class="docutils literal"><span class="pre">Flight</span></code> model stores records in the <code class="docutils literal"><span class="pre">flights</span></code> table. You may specify a custom table by defining a <code class="docutils literal"><span class="pre">table</span></code> property on your model:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * The table associated with the model.
     *
     * &#64;var string
     */
    protected $table = 'my_flights';
}
</pre>
</div>
<div class="section" id="primary-keys">
<span id="primary-keys"></span><h4>Primary Keys<a class="headerlink" href="#primary-keys" title="Permalink to this headline">¶</a></h4>
<p>Eloquent will also assume that each table has a primary key column named <code class="docutils literal"><span class="pre">id</span></code>. You may define a <code class="docutils literal"><span class="pre">$primaryKey</span></code> property to override this convention.</p>
</div>
<div class="section" id="timestamps">
<span id="timestamps"></span><h4>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this headline">¶</a></h4>
<p>By default, Eloquent expects <code class="docutils literal"><span class="pre">created_at</span></code> and <code class="docutils literal"><span class="pre">updated_at</span></code> columns to exist on your tables.  If you do not wish to have these columns automatically managed by Eloquent, set the <code class="docutils literal"><span class="pre">$timestamps</span></code> property on your model to <code class="docutils literal"><span class="pre">false</span></code>:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * Indicates if the model should be timestamped.
     *
     * &#64;var bool
     */
    public $timestamps = false;
}
</pre>
<p>If you need to customize the format of your timestamps, set the <code class="docutils literal"><span class="pre">$dateFormat</span></code> property on your model. This property determines how date attributes are stored in the database, as well as their format when the model is serialized to an array or JSON:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * The storage format of the model's date columns.
     *
     * &#64;var string
     */
    protected $dateFormat = 'U';
}
</pre>
<p><a name="retrieving-multiple-models"></a></p>
</div>
</div>
</div>
<div class="section" id="retrieving-multiple-models">
<span id="retrieving-multiple-models"></span><h2>Retrieving Multiple Models<a class="headerlink" href="#retrieving-multiple-models" title="Permalink to this headline">¶</a></h2>
<p>Once you have created a model and <a class="reference external" href="migrations.html#writing-migrations">its associated database table</a>, you are ready to start retrieving data from your database. Think of each Eloquent model as a powerful <a class="reference external" href="queries.html">query builder</a> allowing you to fluently query the database table associated with the model. For example:</p>
<pre class="literal-block">
&lt;?php

namespace App\Http\Controllers;

use App\Flight;
use App\Http\Controllers\Controller;

class FlightController extends Controller
{
    /**
     * Show a list of all available flights.
     *
     * &#64;return Response
     */
    public function index()
    {
        $flights = Flight::all();

        return view('flight.index', ['flights' =&gt; $flights]);
    }
}
</pre>
<div class="section" id="accessing-column-values">
<span id="accessing-column-values"></span><h3>Accessing Column Values<a class="headerlink" href="#accessing-column-values" title="Permalink to this headline">¶</a></h3>
<p>If you have an Eloquent model instance, you may access the column values of the model by accessing the corresponding property. For example, let&#8217;s loop through each <code class="docutils literal"><span class="pre">Flight</span></code> instance returned by our query and echo the value of the <code class="docutils literal"><span class="pre">name</span></code> column:</p>
<pre class="literal-block">
foreach ($flights as $flight) {
    echo $flight-&gt;name;
}
</pre>
</div>
<div class="section" id="adding-additional-constraints">
<span id="adding-additional-constraints"></span><h3>Adding Additional Constraints<a class="headerlink" href="#adding-additional-constraints" title="Permalink to this headline">¶</a></h3>
<p>The Eloquent <code class="docutils literal"><span class="pre">all</span></code> method will return all of the results in the model&#8217;s table. Since each Eloquent model serves as a <a class="reference external" href="queries.html">query builder</a>, you may also add constraints to queries, and then use the <code class="docutils literal"><span class="pre">get</span></code> method to retrieve the results:</p>
<pre class="literal-block">
$flights = App\Flight::where('active', 1)
               -&gt;orderBy('name', 'desc')
               -&gt;take(10)
               -&gt;get();
</pre>
<blockquote>
<div><strong>Note:</strong> Since Eloquent models are query builders, you should review all of the methods available on the <a class="reference external" href="queries.html">query builder</a>. You may use any of these methods in your Eloquent queries.</div></blockquote>
</div>
<div class="section" id="collections">
<span id="collections"></span><h3>Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h3>
<p>For Eloquent methods like <code class="docutils literal"><span class="pre">all</span></code> and <code class="docutils literal"><span class="pre">get</span></code> which retrieve multiple results, an instance of <code class="docutils literal"><span class="pre">Illuminate\Database\Eloquent\Collection</span></code> will be returned. The <code class="docutils literal"><span class="pre">Collection</span></code> class provides <a class="reference external" href="eloquent-collections.html#available-methods">a variety of helpful methods</a> for working with your Eloquent results. Of course, you may simply loop over this collection like an array:</p>
<pre class="literal-block">
foreach ($flights as $flight) {
    echo $flight-&gt;name;
}
</pre>
</div>
<div class="section" id="chunking-results">
<span id="chunking-results"></span><h3>Chunking Results<a class="headerlink" href="#chunking-results" title="Permalink to this headline">¶</a></h3>
<p>If you need to process thousands of Eloquent records, use the <code class="docutils literal"><span class="pre">chunk</span></code> command. The <code class="docutils literal"><span class="pre">chunk</span></code> method will retrieve a &#8220;chunk&#8221; of Eloquent models, feeding them to a given <code class="docutils literal"><span class="pre">Closure</span></code> for processing. Using the <code class="docutils literal"><span class="pre">chunk</span></code> method will conserve memory when working with large result sets:</p>
<pre class="literal-block">
Flight::chunk(200, function ($flights) {
    foreach ($flights as $flight) {
        //
    }
});
</pre>
<p>The first argument passed to the method is the number of records you wish to receive per &#8220;chunk&#8221;. The Closure passed as the second argument will be called for each chunk that is retrieved from the database.</p>
<p><a name="retrieving-single-models"></a></p>
</div>
</div>
<div class="section" id="retrieving-single-models-aggregates">
<span id="retrieving-single-models-aggregates"></span><h2>Retrieving Single Models / Aggregates<a class="headerlink" href="#retrieving-single-models-aggregates" title="Permalink to this headline">¶</a></h2>
<p>Of course, in addition to retrieving all of the records for a given table, you may also retrieve single records using <code class="docutils literal"><span class="pre">find</span></code> and <code class="docutils literal"><span class="pre">first</span></code>. Instead of returning a collection of models, these methods return a single model instance:</p>
<pre class="literal-block">
// Retrieve a model by its primary key...
$flight = App\Flight::find(1);

// Retrieve the first model matching the query constraints...
$flight = App\Flight::where('active', 1)-&gt;first();
</pre>
<div class="section" id="not-found-exceptions">
<span id="not-found-exceptions"></span><h3>Not Found Exceptions<a class="headerlink" href="#not-found-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may wish to throw an exception if a model is not found. This is particularly useful in routes or controllers. The <code class="docutils literal"><span class="pre">findOrFail</span></code> and <code class="docutils literal"><span class="pre">firstOrFail</span></code> methods will retrieve the first result of the query. However, if no result is found, a <code class="docutils literal"><span class="pre">Illuminate\Database\Eloquent\ModelNotFoundException</span></code> will be thrown:</p>
<pre class="literal-block">
$model = App\Flight::findOrFail(1);

$model = App\Flight::where('legs', '&gt;', 100)-&gt;firstOrFail();
</pre>
<p>If the exception is not caught, a <code class="docutils literal"><span class="pre">404</span></code> HTTP response is automatically sent back to the user, so it is not necessary to write explicit checks to return <code class="docutils literal"><span class="pre">404</span></code> responses when using these methods:</p>
<pre class="literal-block">
Route::get('/api/flights/{id}', function ($id) {
    return App\Flight::findOrFail($id);
});
</pre>
<p><a name="retrieving-aggregates"></a></p>
</div>
<div class="section" id="retrieving-aggregates">
<span id="retrieving-aggregates"></span><h3>Retrieving Aggregates<a class="headerlink" href="#retrieving-aggregates" title="Permalink to this headline">¶</a></h3>
<p>Of course, you may also use <code class="docutils literal"><span class="pre">count</span></code>, <code class="docutils literal"><span class="pre">sum</span></code>, <code class="docutils literal"><span class="pre">max</span></code>, and other <a class="reference external" href="queries#aggregates.html">aggregate functions</a> provided by the <a class="reference external" href="queries.html">query builder</a>. These methods return the appropriate scalar value instead of a full model instance:</p>
<pre class="literal-block">
$count = App\Flight::where('active', 1)-&gt;count();

$max = App\Flight::where('active', 1)-&gt;max('price');
</pre>
<p><a name="inserting-and-updating-models"></a></p>
</div>
</div>
<div class="section" id="inserting-updating-models">
<span id="inserting-updating-models"></span><h2>Inserting &amp; Updating Models<a class="headerlink" href="#inserting-updating-models" title="Permalink to this headline">¶</a></h2>
<p><a name="basic-inserts"></a></p>
<div class="section" id="basic-inserts">
<span id="basic-inserts"></span><h3>Basic Inserts<a class="headerlink" href="#basic-inserts" title="Permalink to this headline">¶</a></h3>
<p>To create a new record in the database, simply create a new model instance, set attributes on the model, then call the <code class="docutils literal"><span class="pre">save</span></code> method:</p>
<pre class="literal-block">
&lt;?php

namespace App\Http\Controllers;

use App\Flight;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

class FlightController extends Controller
{
    /**
     * Create a new flight instance.
     *
     * &#64;param  Request  $request
     * &#64;return Response
     */
    public function store(Request $request)
    {
        // Validate the request...

        $flight = new Flight;

        $flight-&gt;name = $request-&gt;name;

        $flight-&gt;save();
    }
}
</pre>
<p>In this example, we simply assign the <code class="docutils literal"><span class="pre">name</span></code> parameter from the incoming HTTP request to the <code class="docutils literal"><span class="pre">name</span></code> attribute of the <code class="docutils literal"><span class="pre">App\Flight</span></code> model instance. When we call the <code class="docutils literal"><span class="pre">save</span></code> method, a record will be inserted into the database. The <code class="docutils literal"><span class="pre">created_at</span></code> and <code class="docutils literal"><span class="pre">updated_at</span></code> timestamps will automatically be set when the <code class="docutils literal"><span class="pre">save</span></code> method is called, so there is no need to set them manually.</p>
<p><a name="basic-updates"></a></p>
</div>
<div class="section" id="basic-updates">
<span id="basic-updates"></span><h3>Basic Updates<a class="headerlink" href="#basic-updates" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">save</span></code> method may also be used to update models that already exist in the database. To update a model, you should retrieve it, set any attributes you wish to update, and then call the <code class="docutils literal"><span class="pre">save</span></code> method. Again, the <code class="docutils literal"><span class="pre">updated_at</span></code> timestamp will automatically be updated, so there is no need to manually set its value:</p>
<pre class="literal-block">
$flight = App\Flight::find(1);

$flight-&gt;name = 'New Flight Name';

$flight-&gt;save();
</pre>
<p>Updates can also be performed against any number of models that match a given query. In this example, all flights that are <code class="docutils literal"><span class="pre">active</span></code> and have a <code class="docutils literal"><span class="pre">destination</span></code> of <code class="docutils literal"><span class="pre">San</span> <span class="pre">Diego</span></code> will be marked as delayed:</p>
<pre class="literal-block">
App\Flight::where('active', 1)
          -&gt;where('destination', 'San Diego')
          -&gt;update(['delayed' =&gt; 1]);
</pre>
<p>The <code class="docutils literal"><span class="pre">update</span></code> method expects an array of column and value pairs representing the columns that should be updated.</p>
<p><a name="mass-assignment"></a></p>
</div>
<div class="section" id="mass-assignment">
<span id="mass-assignment"></span><h3>Mass Assignment<a class="headerlink" href="#mass-assignment" title="Permalink to this headline">¶</a></h3>
<p>You may also use the <code class="docutils literal"><span class="pre">create</span></code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code class="docutils literal"><span class="pre">fillable</span></code> or <code class="docutils literal"><span class="pre">guarded</span></code> attribute on the model, as all Eloquent models protect against mass-assignment.</p>
<p>A mass-assignment vulnerability occurs when a user passes an unexpected HTTP parameter through a request, and that parameter changes a column in your database you did not expect. For example, a malicious user might send an <code class="docutils literal"><span class="pre">is_admin</span></code> parameter through an HTTP request, which is then mapped onto your model&#8217;s <code class="docutils literal"><span class="pre">create</span></code> method, allowing the user to escalate themselves to an administrator.</p>
<p>So, to get started, you should define which model attributes you want to make mass assignable. You may do this using the <code class="docutils literal"><span class="pre">$fillable</span></code> property on the model. For example, let&#8217;s make the <code class="docutils literal"><span class="pre">name</span></code> attribute of our <code class="docutils literal"><span class="pre">Flight</span></code> model mass assignable:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * The attributes that are mass assignable.
     *
     * &#64;var array
     */
    protected $fillable = ['name'];
}
</pre>
<p>Once we have made the attributes mass assignable, we can use the <code class="docutils literal"><span class="pre">create</span></code> method to insert a new record in the database. The <code class="docutils literal"><span class="pre">create</span></code> method returns the saved model instance:</p>
<pre class="literal-block">
$flight = App\Flight::create(['name' =&gt; 'Flight 10']);
</pre>
<p>While <code class="docutils literal"><span class="pre">$fillable</span></code> serves as a &#8220;white list&#8221; of attributes that should be mass assignable, you may also choose to use <code class="docutils literal"><span class="pre">$guarded</span></code>. The <code class="docutils literal"><span class="pre">$guarded</span></code> property should contain an array of attributes that you do not want to be mass assignable. All other attributes not in the array will be mass assignable. So, <code class="docutils literal"><span class="pre">$guarded</span></code> functions like a &#8220;black list&#8221;. Of course, you should use either <code class="docutils literal"><span class="pre">$fillable</span></code> or <code class="docutils literal"><span class="pre">$guarded</span></code> - not both:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * The attributes that aren't mass assignable.
     *
     * &#64;var array
     */
    protected $guarded = ['price'];
}
</pre>
<p>In the example above, all attributes <strong>except for <code class="docutils literal"><span class="pre">price</span></code></strong> will be mass assignable.</p>
<div class="section" id="other-creation-methods">
<span id="other-creation-methods"></span><h4>Other Creation Methods<a class="headerlink" href="#other-creation-methods" title="Permalink to this headline">¶</a></h4>
<p>There are two other methods you may use to create models by mass assigning attributes: <code class="docutils literal"><span class="pre">firstOrCreate</span></code> and <code class="docutils literal"><span class="pre">firstOrNew</span></code>. The <code class="docutils literal"><span class="pre">firstOrCreate</span></code> method will attempt to locate a database record using the given column / value pairs. If the model can not be found in the database, a record will be inserted with the given attributes.</p>
<p>The <code class="docutils literal"><span class="pre">firstOrNew</span></code> method, like <code class="docutils literal"><span class="pre">firstOrCreate</span></code> will attempt to locate a record in the database matching the given attributes. However, if a model is not found, a new model instance will be returned. Note that the model returned by <code class="docutils literal"><span class="pre">firstOrNew</span></code> has not yet been persisted to the database. You will need to call <code class="docutils literal"><span class="pre">save</span></code> manually to persist it:</p>
<pre class="literal-block">
// Retrieve the flight by the attributes, or create it if it doesn't exist...
$flight = App\Flight::firstOrCreate(['name' =&gt; 'Flight 10']);

// Retrieve the flight by the attributes, or instantiate a new instance...
$flight = App\Flight::firstOrNew(['name' =&gt; 'Flight 10']);
</pre>
<p><a name="deleting-models"></a></p>
</div>
</div>
</div>
<div class="section" id="deleting-models">
<span id="deleting-models"></span><h2>Deleting Models<a class="headerlink" href="#deleting-models" title="Permalink to this headline">¶</a></h2>
<p>To delete a model, call the <code class="docutils literal"><span class="pre">delete</span></code> method on a model instance:</p>
<pre class="literal-block">
$flight = App\Flight::find(1);

$flight-&gt;delete();
</pre>
<div class="section" id="deleting-an-existing-model-by-key">
<span id="deleting-an-existing-model-by-key"></span><h3>Deleting An Existing Model By Key<a class="headerlink" href="#deleting-an-existing-model-by-key" title="Permalink to this headline">¶</a></h3>
<p>In the example above, we are retrieving the model from the database before calling the <code class="docutils literal"><span class="pre">delete</span></code> method. However, if you know the primary key of the model, you may delete the model without retrieving it. To do so, call the <code class="docutils literal"><span class="pre">destroy</span></code> method:</p>
<pre class="literal-block">
App\Flight::destroy(1);

App\Flight::destroy([1, 2, 3]);

App\Flight::destroy(1, 2, 3);
</pre>
</div>
<div class="section" id="deleting-models-by-query">
<span id="deleting-models-by-query"></span><h3>Deleting Models By Query<a class="headerlink" href="#deleting-models-by-query" title="Permalink to this headline">¶</a></h3>
<p>Of course, you may also run a delete query on a set of models. In this example, we will delete all flights that are marked as inactive:</p>
<pre class="literal-block">
$deletedRows = App\Flight::where('active', 0)-&gt;delete();
</pre>
<p><a name="soft-deleting"></a></p>
</div>
<div class="section" id="soft-deleting">
<span id="soft-deleting"></span><h3>Soft Deleting<a class="headerlink" href="#soft-deleting" title="Permalink to this headline">¶</a></h3>
<p>In addition to actually removing records from your database, Eloquent can also &#8220;soft delete&#8221; models. When models are soft deleted, they are not actually removed from your database. Instead, a <code class="docutils literal"><span class="pre">deleted_at</span></code> attribute is set on the model and inserted into the database. If a model has a non-null <code class="docutils literal"><span class="pre">deleted_at</span></code> value, the model has been soft deleted. To enable soft deletes for a model, use the <code class="docutils literal"><span class="pre">Illuminate\Database\Eloquent\SoftDeletes</span></code> trait on the model and add the <code class="docutils literal"><span class="pre">deleted_at</span></code> column to your <code class="docutils literal"><span class="pre">$dates</span></code> property:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Flight extends Model
{
    use SoftDeletes;

    /**
     * The attributes that should be mutated to dates.
     *
     * &#64;var array
     */
    protected $dates = ['deleted_at'];
}
</pre>
<p>Of course, you should add the <code class="docutils literal"><span class="pre">deleted_at</span></code> column to your database table. The Laravel <a class="reference external" href="migrations.html">schema builder</a> contains a helper method to create this column:</p>
<pre class="literal-block">
Schema::table('flights', function ($table) {
    $table-&gt;softDeletes();
});
</pre>
<p>Now, when you call the <code class="docutils literal"><span class="pre">delete</span></code> method on the model, the <code class="docutils literal"><span class="pre">deleted_at</span></code> column will be set to the current date and time. And, when querying a model that uses soft deletes, the soft deleted models will automatically be excluded from all query results.</p>
<p>To determine if a given model instance has been soft deleted, use the <code class="docutils literal"><span class="pre">trashed</span></code> method:</p>
<pre class="literal-block">
if ($flight-&gt;trashed()) {
    //
}
</pre>
<p><a name="querying-soft-deleted-models"></a></p>
</div>
<div class="section" id="querying-soft-deleted-models">
<span id="querying-soft-deleted-models"></span><h3>Querying Soft Deleted Models<a class="headerlink" href="#querying-soft-deleted-models" title="Permalink to this headline">¶</a></h3>
<div class="section" id="including-soft-deleted-models">
<span id="including-soft-deleted-models"></span><h4>Including Soft Deleted Models<a class="headerlink" href="#including-soft-deleted-models" title="Permalink to this headline">¶</a></h4>
<p>As noted above, soft deleted models will automatically be excluded from query results. However, you may force soft deleted models to appear in a result set using the <code class="docutils literal"><span class="pre">withTrashed</span></code> method on the query:</p>
<pre class="literal-block">
$flights = App\Flight::withTrashed()
                -&gt;where('account_id', 1)
                -&gt;get();
</pre>
<p>The <code class="docutils literal"><span class="pre">withTrashed</span></code> method may also be used on a <a class="reference external" href="eloquent-relationships.html">relationship</a> query:</p>
<pre class="literal-block">
$flight-&gt;history()-&gt;withTrashed()-&gt;get();
</pre>
</div>
<div class="section" id="retrieving-only-soft-deleted-models">
<span id="retrieving-only-soft-deleted-models"></span><h4>Retrieving Only Soft Deleted Models<a class="headerlink" href="#retrieving-only-soft-deleted-models" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">onlyTrashed</span></code> method will retrieve <strong>only</strong> soft deleted models:</p>
<pre class="literal-block">
$flights = App\Flight::onlyTrashed()
                -&gt;where('airline_id', 1)
                -&gt;get();
</pre>
</div>
<div class="section" id="restoring-soft-deleted-models">
<span id="restoring-soft-deleted-models"></span><h4>Restoring Soft Deleted Models<a class="headerlink" href="#restoring-soft-deleted-models" title="Permalink to this headline">¶</a></h4>
<p>Sometimes you may wish to &#8220;un-delete&#8221; a soft deleted model. To restore a soft deleted model into an active state, use the <code class="docutils literal"><span class="pre">restore</span></code> method on a model instance:</p>
<pre class="literal-block">
$flight-&gt;restore();
</pre>
<p>You may also use the <code class="docutils literal"><span class="pre">restore</span></code> method in a query to quickly restore multiple models:</p>
<pre class="literal-block">
App\Flight::withTrashed()
        -&gt;where('airline_id', 1)
        -&gt;restore();
</pre>
<p>Like the <code class="docutils literal"><span class="pre">withTrashed</span></code> method, the <code class="docutils literal"><span class="pre">restore</span></code> method may also be used on <a class="reference external" href="eloquent-relationships.html">relationships</a>:</p>
<pre class="literal-block">
$flight-&gt;history()-&gt;restore();
</pre>
</div>
<div class="section" id="permanently-deleting-models">
<span id="permanently-deleting-models"></span><h4>Permanently Deleting Models<a class="headerlink" href="#permanently-deleting-models" title="Permalink to this headline">¶</a></h4>
<p>Sometimes you may need to truly remove a model from your database. To permanently remove a soft deleted model from the database, use the <code class="docutils literal"><span class="pre">forceDelete</span></code> method:</p>
<pre class="literal-block">
// Force deleting a single model instance...
$flight-&gt;forceDelete();

// Force deleting all related models...
$flight-&gt;history()-&gt;forceDelete();
</pre>
<p><a name="query-scopes"></a></p>
</div>
</div>
</div>
<div class="section" id="query-scopes">
<span id="query-scopes"></span><h2>Query Scopes<a class="headerlink" href="#query-scopes" title="Permalink to this headline">¶</a></h2>
<p>Scopes allow you to define common sets of constraints that you may easily re-use throughout your application. For example, you may need to frequently retrieve all users that are considered &#8220;popular&#8221;. To define a scope, simply prefix an Eloquent model method with <code class="docutils literal"><span class="pre">scope</span></code>:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     * Scope a query to only include popular users.
     *
     * &#64;return \Illuminate\Database\Eloquent\Builder
     */
    public function scopePopular($query)
    {
        return $query-&gt;where('votes', '&gt;', 100);
    }

    /**
     * Scope a query to only include active users.
     *
     * &#64;return \Illuminate\Database\Eloquent\Builder
     */
    public function scopeActive($query)
    {
        return $query-&gt;where('active', 1);
    }
}
</pre>
<div class="section" id="utilizing-a-query-scope">
<span id="utilizing-a-query-scope"></span><h3>Utilizing A Query Scope<a class="headerlink" href="#utilizing-a-query-scope" title="Permalink to this headline">¶</a></h3>
<p>Once the scope has been defined, you may call the scope methods when querying the model. However, you do not need to include the <code class="docutils literal"><span class="pre">scope</span></code> prefix when calling the method. You can even chain calls to various scopes, for example:</p>
<pre class="literal-block">
$users = App\User::popular()-&gt;active()-&gt;orderBy('created_at')-&gt;get();
</pre>
</div>
<div class="section" id="dynamic-scopes">
<span id="dynamic-scopes"></span><h3>Dynamic Scopes<a class="headerlink" href="#dynamic-scopes" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may wish to define a scope that accepts parameters. To get started, just add your additional parameters to your scope. Scope parameters should be defined after the <code class="docutils literal"><span class="pre">$query</span></code> argument:</p>
<pre class="literal-block">
&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     * Scope a query to only include users of a given type.
     *
     * &#64;return \Illuminate\Database\Eloquent\Builder
     */
    public function scopeOfType($query, $type)
    {
        return $query-&gt;where('type', $type);
    }
}
</pre>
<p>Now, you may pass the parameters when calling the scope:</p>
<pre class="literal-block">
$users = App\User::ofType('admin')-&gt;get();
</pre>
<p><a name="events"></a></p>
</div>
</div>
<div class="section" id="events">
<span id="events"></span><h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>Eloquent models fire several events, allowing you to hook into various points in the model&#8217;s lifecycle using the following methods: <code class="docutils literal"><span class="pre">creating</span></code>, <code class="docutils literal"><span class="pre">created</span></code>, <code class="docutils literal"><span class="pre">updating</span></code>, <code class="docutils literal"><span class="pre">updated</span></code>, <code class="docutils literal"><span class="pre">saving</span></code>, <code class="docutils literal"><span class="pre">saved</span></code>, <code class="docutils literal"><span class="pre">deleting</span></code>, <code class="docutils literal"><span class="pre">deleted</span></code>, <code class="docutils literal"><span class="pre">restoring</span></code>, <code class="docutils literal"><span class="pre">restored</span></code>. Events allow you to easily execute code each time a specific model class is saved or updated in the database.</p>
<p><a name="basic-usage"></a></p>
<div class="section" id="basic-usage">
<span id="basic-usage"></span><h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>Whenever a new model is saved for the first time, the <code class="docutils literal"><span class="pre">creating</span></code> and <code class="docutils literal"><span class="pre">created</span></code> events will fire. If a model already existed in the database and the <code class="docutils literal"><span class="pre">save</span></code> method is called, the <code class="docutils literal"><span class="pre">updating</span></code> / <code class="docutils literal"><span class="pre">updated</span></code> events will fire. However, in both cases, the <code class="docutils literal"><span class="pre">saving</span></code> / <code class="docutils literal"><span class="pre">saved</span></code> events will fire.</p>
<p>For example, let&#8217;s define an Eloquent event listener in a <a class="reference external" href="providers.html">service provider</a>. Within our event listener, we will call the <code class="docutils literal"><span class="pre">isValid</span></code> method on the given model, and return <code class="docutils literal"><span class="pre">false</span></code> if the model is not valid. Returning <code class="docutils literal"><span class="pre">false</span></code> from an Eloquent event listener will cancel the <code class="docutils literal"><span class="pre">save</span></code> / <code class="docutils literal"><span class="pre">update</span></code> operation:</p>
<pre class="literal-block">
&lt;?php

namespace App\Providers;

use App\User;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * &#64;return void
     */
    public function boot()
    {
        User::creating(function ($user) {
            if ( ! $user-&gt;isValid()) {
                return false;
            }
        });
    }

    /**
     * Register the service provider.
     *
     * &#64;return void
     */
    public function register()
    {
        //
    }
}
</pre>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, The Weezqyd.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>