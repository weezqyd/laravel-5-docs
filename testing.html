

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing &mdash; Laravel 5 Documentation 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Laravel 5 Documentation 1.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Laravel 5 Documentation
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#test-environment">Test Environment</a></li>
<li><a class="reference internal" href="#defining-running-tests">Defining &amp; Running Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-testing">Application Testing</a><ul>
<li><a class="reference internal" href="#interacting-with-your-application">Interacting With Your Application</a><ul>
<li><a class="reference internal" href="#clicking-links">Clicking Links</a></li>
<li><a class="reference internal" href="#working-with-forms">Working With Forms</a></li>
<li><a class="reference internal" href="#working-with-attachments">Working With Attachments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-json-apis">Testing JSON APIs</a><ul>
<li><a class="reference internal" href="#verify-exact-json-match">Verify Exact JSON Match</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sessions-authentication">Sessions / Authentication</a></li>
<li><a class="reference internal" href="#disabling-middleware">Disabling Middleware</a></li>
<li><a class="reference internal" href="#custom-http-requests">Custom HTTP Requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-databases">Working With Databases</a><ul>
<li><a class="reference internal" href="#resetting-the-database-after-each-test">Resetting The Database After Each Test</a><ul>
<li><a class="reference internal" href="#using-migrations">Using Migrations</a></li>
<li><a class="reference internal" href="#using-transactions">Using Transactions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#model-factories">Model Factories</a><ul>
<li><a class="reference internal" href="#multiple-factory-types">Multiple Factory Types</a></li>
<li><a class="reference internal" href="#using-factories-in-tests">Using Factories In Tests</a></li>
<li><a class="reference internal" href="#persisting-factory-models">Persisting Factory Models</a></li>
<li><a class="reference internal" href="#adding-relations-to-models">Adding Relations To Models</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#mocking">Mocking</a><ul>
<li><a class="reference internal" href="#mocking-events">Mocking Events</a></li>
<li><a class="reference internal" href="#mocking-jobs">Mocking Jobs</a></li>
<li><a class="reference internal" href="#mocking-facades">Mocking Facades</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Laravel 5 Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Testing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/testing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing">
<span id="testing"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#application-testing">Application Testing</a><ul>
<li><a class="reference external" href="#interacting-with-your-application">Interacting With Your Application</a></li>
<li><a class="reference external" href="#testing-json-apis">Testing JSON APIs</a></li>
<li><a class="reference external" href="#sessions-and-authentication">Sessions / Authentication</a></li>
<li><a class="reference external" href="#disabling-middleware">Disabling Middleware</a></li>
<li><a class="reference external" href="#custom-http-requests">Custom HTTP Requests</a></li>
</ul>
</li>
<li><a class="reference external" href="#working-with-databases">Working With Databases</a><ul>
<li><a class="reference external" href="#resetting-the-database-after-each-test">Resetting The Database After Each Test</a></li>
<li><a class="reference external" href="#model-factories">Model Factories</a></li>
</ul>
</li>
<li><a class="reference external" href="#mocking">Mocking</a><ul>
<li><a class="reference external" href="#mocking-events">Mocking Events</a></li>
<li><a class="reference external" href="#mocking-jobs">Mocking Jobs</a></li>
<li><a class="reference external" href="#mocking-facades">Mocking Facades</a></li>
</ul>
</li>
</ul>
<p><a name="introduction"></a></p>
<div class="section" id="introduction">
<span id="introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Laravel is built with testing in mind. In fact, support for testing with PHPUnit is included out of the box, and a <code class="docutils literal"><span class="pre">phpunit.xml</span></code> file is already setup for your application. The framework also ships with convenient helper methods allowing you to expressively test your applications.</p>
<p>An <code class="docutils literal"><span class="pre">ExampleTest.php</span></code> file is provided in the <code class="docutils literal"><span class="pre">tests</span></code> directory. After installing a new Laravel application, simply run <code class="docutils literal"><span class="pre">phpunit</span></code> on the command line to run your tests.</p>
<div class="section" id="test-environment">
<span id="test-environment"></span><h3>Test Environment<a class="headerlink" href="#test-environment" title="Permalink to this headline">¶</a></h3>
<p>When running tests, Laravel will automatically set the configuration environment to <code class="docutils literal"><span class="pre">testing</span></code>. Laravel automatically configures the session and cache to the <code class="docutils literal"><span class="pre">array</span></code> driver while testing, meaning no session or cache data will be persisted while testing.</p>
<p>You are free to create other testing environment configurations as necessary. The <code class="docutils literal"><span class="pre">testing</span></code> environment variables may be configured in the <code class="docutils literal"><span class="pre">phpunit.xml</span></code> file.</p>
</div>
<div class="section" id="defining-running-tests">
<span id="defining-running-tests"></span><h3>Defining &amp; Running Tests<a class="headerlink" href="#defining-running-tests" title="Permalink to this headline">¶</a></h3>
<p>To create a new test case, use the <code class="docutils literal"><span class="pre">make:test</span></code> Artisan command:</p>
<pre class="literal-block">
php artisan make:test UserTest
</pre>
<p>This command will place a new <code class="docutils literal"><span class="pre">UserTest</span></code> class within your <code class="docutils literal"><span class="pre">tests</span></code> directory. You may then define test methods as you normally would using PHPUnit. To run your tests, simply execute the <code class="docutils literal"><span class="pre">phpunit</span></code> command from your terminal:</p>
<pre class="literal-block">
&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseMigrations;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class UserTest extends TestCase
{
    /**
     * A basic test example.
     *
     * &#64;return void
     */
    public function testExample()
    {
        $this-&gt;assertTrue(true);
    }
}
</pre>
<blockquote>
<div><strong>Note:</strong> If you define your own <code class="docutils literal"><span class="pre">setUp</span></code> method within a test class, be sure to call <code class="docutils literal"><span class="pre">parent::setUp</span></code>.</div></blockquote>
<p><a name="application-testing"></a></p>
</div>
</div>
<div class="section" id="application-testing">
<span id="application-testing"></span><h2>Application Testing<a class="headerlink" href="#application-testing" title="Permalink to this headline">¶</a></h2>
<p>Laravel provides a very fluent API for making HTTP requests to your application, examining the output, and even filling out forms. For example, take a look at the <code class="docutils literal"><span class="pre">ExampleTest.php</span></code> file included in your <code class="docutils literal"><span class="pre">tests</span></code> directory:</p>
<pre class="literal-block">
&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class ExampleTest extends TestCase
{
    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;visit('/')
             -&gt;see('Laravel 5')
             -&gt;dontSee('Rails');
    }
}
</pre>
<p>The <code class="docutils literal"><span class="pre">visit</span></code> method makes a <code class="docutils literal"><span class="pre">GET</span></code> request into the application. The <code class="docutils literal"><span class="pre">see</span></code> method asserts that we should see the given text in the response returned by the application. The <code class="docutils literal"><span class="pre">dontSee</span></code> method asserts that the given text is not returned in the application response. This is the most basic application test available in Laravel.</p>
<p><a name="interacting-with-your-application"></a></p>
<div class="section" id="interacting-with-your-application">
<span id="interacting-with-your-application"></span><h3>Interacting With Your Application<a class="headerlink" href="#interacting-with-your-application" title="Permalink to this headline">¶</a></h3>
<p>Of course, you can do much more than simply assert that text appears in a given response. Let&#8217;s take a look at some examples of clicking links and filling out forms:</p>
<div class="section" id="clicking-links">
<span id="clicking-links"></span><h4>Clicking Links<a class="headerlink" href="#clicking-links" title="Permalink to this headline">¶</a></h4>
<p>In this test, we will make a request to the application, &#8220;click&#8221; a link in the returned response, and then assert that we landed on a given URI. For example, let&#8217;s assume there is a link in our response that has a text value of &#8220;About Us&#8221;:</p>
<pre class="literal-block">
&lt;a href=&quot;/about-us&quot;&gt;About Us&lt;/a&gt;
</pre>
<p>Now, let&#8217;s write a test that clicks the link and asserts the user lands on the correct page:</p>
<pre class="literal-block">
public function testBasicExample()
{
    $this-&gt;visit('/')
         -&gt;click('About Us')
         -&gt;seePageIs('/about-us');
}
</pre>
</div>
<div class="section" id="working-with-forms">
<span id="working-with-forms"></span><h4>Working With Forms<a class="headerlink" href="#working-with-forms" title="Permalink to this headline">¶</a></h4>
<p>Laravel also provides several methods for testing forms. The <code class="docutils literal"><span class="pre">type</span></code>, <code class="docutils literal"><span class="pre">select</span></code>, <code class="docutils literal"><span class="pre">check</span></code>, <code class="docutils literal"><span class="pre">attach</span></code>, and <code class="docutils literal"><span class="pre">press</span></code> methods allow you to interact with all of your form&#8217;s inputs. For example, let&#8217;s imagine this form exists on the application&#8217;s registration page:</p>
<pre class="literal-block">
&lt;form action=&quot;/register&quot; method=&quot;POST&quot;&gt;
    {!! csrf_field() !!}

    &lt;div&gt;
        Name: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;input type=&quot;checkbox&quot; value=&quot;yes&quot; name=&quot;terms&quot;&gt; Accept Terms
    &lt;/div&gt;

    &lt;div&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Register&quot;&gt;
    &lt;/div&gt;
&lt;/form&gt;
</pre>
<p>We can write a test to complete this form and inspect the result:</p>
<pre class="literal-block">
public function testNewUserRegistration()
{
    $this-&gt;visit('/register')
         -&gt;type('Taylor', 'name')
         -&gt;check('terms')
         -&gt;press('Register')
         -&gt;seePageIs('/dashboard');
}
</pre>
<p>Of course, if your form contains other inputs such as radio buttons or drop-down boxes, you may easily fill out those types of fields as well. Here is a list of each form manipulation method:</p>
<p>Method  | Description
&#8212;&#8212;&#8212;&#8212;- | &#8212;&#8212;&#8212;&#8212;-
<code class="docutils literal"><span class="pre">$this-&gt;type($text,</span> <span class="pre">$elementName)</span></code>  |  &#8220;Type&#8221; text into a given field.
<code class="docutils literal"><span class="pre">$this-&gt;select($value,</span> <span class="pre">$elementName)</span></code>  |  &#8220;Select&#8221; a radio button or drop-down field.
<code class="docutils literal"><span class="pre">$this-&gt;check($elementName)</span></code>  |  &#8220;Check&#8221; a checkbox field.
<code class="docutils literal"><span class="pre">$this-&gt;attach($pathToFile,</span> <span class="pre">$elementName)</span></code>  |  &#8220;Attach&#8221; a file to the form.
<code class="docutils literal"><span class="pre">$this-&gt;press($buttonTextOrElementName)</span></code>  |  &#8220;Press&#8221; a button with the given text or name.</p>
</div>
<div class="section" id="working-with-attachments">
<span id="working-with-attachments"></span><h4>Working With Attachments<a class="headerlink" href="#working-with-attachments" title="Permalink to this headline">¶</a></h4>
<p>If your form contains <code class="docutils literal"><span class="pre">file</span></code> input types, you may attach files to the form using the <code class="docutils literal"><span class="pre">attach</span></code> method:</p>
<pre class="literal-block">
public function testPhotoCanBeUploaded()
{
    $this-&gt;visit('/upload')
         -&gt;name('File Name', 'name')
         -&gt;attach($absolutePathToFile, 'photo')
         -&gt;press('Upload')
         -&gt;see('Upload Successful!');
}
</pre>
<p><a name="testing-json-apis"></a></p>
</div>
</div>
<div class="section" id="testing-json-apis">
<span id="testing-json-apis"></span><h3>Testing JSON APIs<a class="headerlink" href="#testing-json-apis" title="Permalink to this headline">¶</a></h3>
<p>Laravel also provides several helpers for testing JSON APIs and their responses. For example, the <code class="docutils literal"><span class="pre">get</span></code>, <code class="docutils literal"><span class="pre">post</span></code>, <code class="docutils literal"><span class="pre">put</span></code>, <code class="docutils literal"><span class="pre">patch</span></code>, and <code class="docutils literal"><span class="pre">delete</span></code> methods may be used to issue requests with various HTTP verbs. You may also easily pass data and headers to these methods. To get started, let&#8217;s write a test to make a <code class="docutils literal"><span class="pre">POST</span></code> request to <code class="docutils literal"><span class="pre">/user</span></code> and assert that a given array was returned in JSON format:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;post('/user', ['name' =&gt; 'Sally'])
             -&gt;seeJson([
                 'created' =&gt; true,
             ]);
    }
}
</pre>
<p>The <code class="docutils literal"><span class="pre">seeJson</span></code> method converts the given array into JSON, and then verifies that the JSON fragment occurs <strong>anywhere</strong> within the entire JSON response returned by the application. So, if there are other properties in the JSON response, this test will still pass as long as the given fragment is present.</p>
<div class="section" id="verify-exact-json-match">
<span id="verify-exact-json-match"></span><h4>Verify Exact JSON Match<a class="headerlink" href="#verify-exact-json-match" title="Permalink to this headline">¶</a></h4>
<p>If you would like to verify that the given array is an <strong>exact</strong> match for the JSON returned by the application, you should use the <code class="docutils literal"><span class="pre">seeJsonEquals</span></code> method:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;post('/user', ['name' =&gt; 'Sally'])
             -&gt;seeJsonEquals([
                 'created' =&gt; true,
             ]);
    }
}
</pre>
<p><a name="sessions-and-authentication"></a></p>
</div>
</div>
<div class="section" id="sessions-authentication">
<span id="sessions-authentication"></span><h3>Sessions / Authentication<a class="headerlink" href="#sessions-authentication" title="Permalink to this headline">¶</a></h3>
<p>Laravel provides several helpers for working with the session during testing. First, you may set the session data to a given array using the <code class="docutils literal"><span class="pre">withSession</span></code> method. This is useful for loading the session with data before testing a request to your application:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    public function testApplication()
    {
        $this-&gt;withSession(['foo' =&gt; 'bar'])
             -&gt;visit('/');
    }
}
</pre>
<p>Of course, one common use of the session is for maintaining user state, such as the authenticated user. The <code class="docutils literal"><span class="pre">actingAs</span></code> helper method provides a simple way to authenticate a given user as the current user. For example, we may use a <a class="reference external" href="#model-factories">model factory</a> to generate and authenticate a user:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    public function testApplication()
    {
        $user = factory(App\User::class)-&gt;create();

        $this-&gt;actingAs($user)
             -&gt;withSession(['foo' =&gt; 'bar'])
             -&gt;visit('/')
             -&gt;see('Hello, '.$user-&gt;name);
    }
}
</pre>
<p><a name="disabling-middleware"></a></p>
</div>
<div class="section" id="disabling-middleware">
<span id="disabling-middleware"></span><h3>Disabling Middleware<a class="headerlink" href="#disabling-middleware" title="Permalink to this headline">¶</a></h3>
<p>When testing your application, you may find it convenient to disable <a class="reference external" href="/docs/{{version}}/middleware">middleware</a> for some of your tests. This will allow you to test your routes and controller in isolation from any middleware concerns. Laravel includes a simple <code class="docutils literal"><span class="pre">WithoutMiddleware</span></code> trait that you can use to automatically disable all middleware for the test class:</p>
<pre class="literal-block">
&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class ExampleTest extends TestCase
{
    use WithoutMiddleware;

    //
}
</pre>
<p>If you would like to only disable middleware for a few test methods, you may call the <code class="docutils literal"><span class="pre">withoutMiddleware</span></code> method from within the test methods:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;withoutMiddleware();

        $this-&gt;visit('/')
             -&gt;see('Laravel 5');
    }
}
</pre>
<p><a name="custom-http-requests"></a></p>
</div>
<div class="section" id="custom-http-requests">
<span id="custom-http-requests"></span><h3>Custom HTTP Requests<a class="headerlink" href="#custom-http-requests" title="Permalink to this headline">¶</a></h3>
<p>If you would like to make a custom HTTP request into your application and get the full <code class="docutils literal"><span class="pre">Illuminate\Http\Response</span></code> object, you may use the <code class="docutils literal"><span class="pre">call</span></code> method:</p>
<pre class="literal-block">
public function testApplication()
{
    $response = $this-&gt;call('GET', '/');

    $this-&gt;assertEquals(200, $response-&gt;status());
}
</pre>
<p>If you are making <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code>, or <code class="docutils literal"><span class="pre">PATCH</span></code> requests you may pass an array of input data with the request. Of course, this data will be available in your routes and controller via the <a class="reference external" href="/docs/{{version}}/requests">Request instance</a>:</p>
<pre class="literal-block">
   $response = $this-&gt;call('POST', '/user', ['name' =&gt; 'Taylor']);
</pre>
<p><a name="working-with-databases"></a></p>
</div>
</div>
<div class="section" id="working-with-databases">
<span id="working-with-databases"></span><h2>Working With Databases<a class="headerlink" href="#working-with-databases" title="Permalink to this headline">¶</a></h2>
<p>Laravel also provides a variety of helpful tools to make it easier to test your database driven applications. First, you may use the <code class="docutils literal"><span class="pre">seeInDatabase</span></code> helper to assert that data exists in the database matching a given set of criteria. For example, if we would like to verify that there is a record in the <code class="docutils literal"><span class="pre">users</span></code> table with the <code class="docutils literal"><span class="pre">email</span></code> value of <code class="docutils literal"><span class="pre">sally&#64;example.com</span></code>, we can do the following:</p>
<pre class="literal-block">
public function testDatabase()
{
    // Make call to application...

    $this-&gt;seeInDatabase('users', ['email' =&gt; 'sally&#64;foo.com']);
}
</pre>
<p>Of course, the <code class="docutils literal"><span class="pre">seeInDatabase</span></code> method and other helpers like it are for convenience. You are free to use any of PHPUnit&#8217;s built-in assertion methods to supplement your tests.</p>
<p><a name="resetting-the-database-after-each-test"></a></p>
<div class="section" id="resetting-the-database-after-each-test">
<span id="resetting-the-database-after-each-test"></span><h3>Resetting The Database After Each Test<a class="headerlink" href="#resetting-the-database-after-each-test" title="Permalink to this headline">¶</a></h3>
<p>It is often useful to reset your database after each test so that data from a previous test does not interfere with subsequent tests.</p>
<div class="section" id="using-migrations">
<span id="using-migrations"></span><h4>Using Migrations<a class="headerlink" href="#using-migrations" title="Permalink to this headline">¶</a></h4>
<p>One option is to rollback the database after each test and migrate it before the next test. Laravel provides a simple <code class="docutils literal"><span class="pre">DatabaseMigrations</span></code> trait that will automatically handle this for you. Simply use the trait on your test class:</p>
<pre class="literal-block">
&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseMigrations;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class ExampleTest extends TestCase
{
    use DatabaseMigrations;

    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;visit('/')
             -&gt;see('Laravel 5');
    }
}
</pre>
</div>
<div class="section" id="using-transactions">
<span id="using-transactions"></span><h4>Using Transactions<a class="headerlink" href="#using-transactions" title="Permalink to this headline">¶</a></h4>
<p>Another option is to wrap every test case in a database transaction. Again, Laravel provides a convenient <code class="docutils literal"><span class="pre">DatabaseTransactions</span></code> trait that will automatically handle this:</p>
<pre class="literal-block">
&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseMigrations;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class ExampleTest extends TestCase
{
    use DatabaseTransactions;

    /**
     * A basic functional test example.
     *
     * &#64;return void
     */
    public function testBasicExample()
    {
        $this-&gt;visit('/')
             -&gt;see('Laravel 5');
    }
}
</pre>
<p><a name="model-factories"></a></p>
</div>
</div>
<div class="section" id="model-factories">
<span id="model-factories"></span><h3>Model Factories<a class="headerlink" href="#model-factories" title="Permalink to this headline">¶</a></h3>
<p>When testing, it is common to need to insert a few records into your database before executing your test. Instead of manually specifying the value of each column when you create this test data, Laravel allows you to define a default set of attributes for each of your <a class="reference external" href="/docs/{{version}}/eloquent">Eloquent models</a> using &#8220;factories&#8221;. To get started, take a look at the <code class="docutils literal"><span class="pre">database/factories/ModelFactory.php</span></code> file in your application. Out of the box, this file contains one factory definition:</p>
<pre class="literal-block">
$factory-&gt;define(App\User::class, function (Faker\Generator $faker) {
    return [
        'name' =&gt; $faker-&gt;name,
        'email' =&gt; $faker-&gt;email,
        'password' =&gt; bcrypt(str_random(10)),
        'remember_token' =&gt; str_random(10),
    ];
});
</pre>
<p>Within the Closure, which serves as the factory definition, you may return the default test values of all attributes on the model. The Closure will receive an instance of the <a class="reference external" href="https://github.com/fzaninotto/Faker">Faker</a> PHP library, which allows you to conveniently generate various kinds of random data for testing.</p>
<p>Of course, you are free to add your own additional factories to the <code class="docutils literal"><span class="pre">ModelFactory.php</span></code> file.</p>
<div class="section" id="multiple-factory-types">
<span id="multiple-factory-types"></span><h4>Multiple Factory Types<a class="headerlink" href="#multiple-factory-types" title="Permalink to this headline">¶</a></h4>
<p>Sometimes you may wish to have multiple factories for the same Eloquent model class. For example, perhaps you would like to have a factory for &#8220;Administrator&#8221; users in addition to normal users. You may define these factories using the <code class="docutils literal"><span class="pre">defineAs</span></code> method:</p>
<pre class="literal-block">
$factory-&gt;defineAs(App\User::class, 'admin', function ($faker) {
    return [
        'name' =&gt; $faker-&gt;name,
        'email' =&gt; $faker-&gt;email,
        'password' =&gt; str_random(10),
        'remember_token' =&gt; str_random(10),
        'admin' =&gt; true,
    ];
});
</pre>
<p>Instead of duplicating all of the attributes from your base user factory, you may use the <code class="docutils literal"><span class="pre">raw</span></code> method to retrieve the base attributes. Once you have the attributes, simply supplement them with any additional values you require:</p>
<pre class="literal-block">
$factory-&gt;defineAs(App\User::class, 'admin', function ($faker) use ($factory) {
    $user = $factory-&gt;raw(App\User::class);

    return array_merge($user, ['admin' =&gt; true]);
});
</pre>
</div>
<div class="section" id="using-factories-in-tests">
<span id="using-factories-in-tests"></span><h4>Using Factories In Tests<a class="headerlink" href="#using-factories-in-tests" title="Permalink to this headline">¶</a></h4>
<p>Once you have defined your factories, you may use them in your tests or database seed files to generate model instances using the global <code class="docutils literal"><span class="pre">factory</span></code> function. So, let&#8217;s take a look at a few examples of creating models. First, we&#8217;ll use the <code class="docutils literal"><span class="pre">make</span></code> method, which creates models but does not save them to the database:</p>
<pre class="literal-block">
public function testDatabase()
{
    $user = factory(App\User::class)-&gt;make();

    // Use model in tests...
}
</pre>
<p>If you would like to override some of the default values of your models, you may pass an array of values to the <code class="docutils literal"><span class="pre">make</span></code> method. Only the specified values will be replaced while the rest of the values remain set to their default values as specified by the factory:</p>
<pre class="literal-block">
$user = factory(App\User::class)-&gt;make([
    'name' =&gt; 'Abigail',
   ]);
</pre>
<p>You may also create a Collection of many models or create models of a given type:</p>
<pre class="literal-block">
// Create three App\User instances...
$users = factory(App\User::class, 3)-&gt;make();

// Create an App\User &quot;admin&quot; instance...
$user = factory(App\User::class, 'admin')-&gt;make();

// Create three App\User &quot;admin&quot; instances...
$users = factory(App\User::class, 'admin', 3)-&gt;make();
</pre>
</div>
<div class="section" id="persisting-factory-models">
<span id="persisting-factory-models"></span><h4>Persisting Factory Models<a class="headerlink" href="#persisting-factory-models" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">create</span></code> method not only creates the model instances, but also saves them to the database using Eloquent&#8217;s <code class="docutils literal"><span class="pre">save</span></code> method:</p>
<pre class="literal-block">
public function testDatabase()
{
    $user = factory(App\User::class)-&gt;create();

    // Use model in tests...
}
</pre>
<p>Again, you may override attributes on the model by passing an array to the <code class="docutils literal"><span class="pre">create</span></code> method:</p>
<pre class="literal-block">
$user = factory(App\User::class)-&gt;create([
    'name' =&gt; 'Abigail',
   ]);
</pre>
</div>
<div class="section" id="adding-relations-to-models">
<span id="adding-relations-to-models"></span><h4>Adding Relations To Models<a class="headerlink" href="#adding-relations-to-models" title="Permalink to this headline">¶</a></h4>
<p>You may even persist multiple models to the database. In this example, we&#8217;ll even attach a relation to the created models. When using the <code class="docutils literal"><span class="pre">create</span></code> method to create multiple models, an Eloquent <a class="reference external" href="/docs/{{version}}/eloquent-collections">collection instance</a> is returned, allowing you to use any of the convenient functions provided by the collection, such as <code class="docutils literal"><span class="pre">each</span></code>:</p>
<pre class="literal-block">
$users = factory(App\User::class, 3)
           -&gt;create()
           -&gt;each(function($u) {
                $u-&gt;posts()-&gt;save(factory(App\Post::class)-&gt;make());
            });
</pre>
<p><a name="mocking"></a></p>
</div>
</div>
</div>
<div class="section" id="mocking">
<span id="mocking"></span><h2>Mocking<a class="headerlink" href="#mocking" title="Permalink to this headline">¶</a></h2>
<p><a name="mocking-events"></a></p>
<div class="section" id="mocking-events">
<span id="mocking-events"></span><h3>Mocking Events<a class="headerlink" href="#mocking-events" title="Permalink to this headline">¶</a></h3>
<p>If you are making heavy use of Laravel&#8217;s event system, you may wish to silence or mock certain events while testing. For example, if you are testing user registration, you probably do not want all of a <code class="docutils literal"><span class="pre">UserRegistered</span></code> event&#8217;s handlers firing, since these may send &#8220;welcome&#8221; e-mails, etc.</p>
<p>Laravel provides a convenient <code class="docutils literal"><span class="pre">expectsEvents</span></code> method that verifies the expected events are fired, but prevents any handlers for those events from running:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    public function testUserRegistration()
    {
        $this-&gt;expectsEvents(App\Events\UserRegistered::class);

        // Test user registration code...
    }
}
</pre>
<p>If you would like to prevent all event handlers from running, you may use the <code class="docutils literal"><span class="pre">withoutEvents</span></code> method:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    public function testUserRegistration()
    {
        $this-&gt;withoutEvents();

        // Test user registration code...
    }
}
</pre>
<p><a name="mocking-jobs"></a></p>
</div>
<div class="section" id="mocking-jobs">
<span id="mocking-jobs"></span><h3>Mocking Jobs<a class="headerlink" href="#mocking-jobs" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, you may wish to simply test that specific jobs are dispatched by your controllers when making requests to your application. This allows you to test your routes / controllers in isolation - set apart from your job&#8217;s logic. Of course, you can then test the job itself in a separate test class.</p>
<p>Laravel provides a convenient <code class="docutils literal"><span class="pre">expectsJobs</span></code> method that will verify that the expected jobs are dispatched, but the job itself will not be executed:</p>
<pre class="literal-block">
&lt;?php

class ExampleTest extends TestCase
{
    public function testPurchasePodcast()
    {
        $this-&gt;expectsJobs(App\Jobs\PurchasePodcast::class);

        // Test purchase podcast code...
    }
}
</pre>
<blockquote>
<div><strong>Note:</strong> This method only detects jobs that are dispatched via the <code class="docutils literal"><span class="pre">DispatchesJobs</span></code> trait&#8217;s dispatch methods. It does not detect jobs that are sent directly to <code class="docutils literal"><span class="pre">Queue::push</span></code>.</div></blockquote>
<p><a name="mocking-facades"></a></p>
</div>
<div class="section" id="mocking-facades">
<span id="mocking-facades"></span><h3>Mocking Facades<a class="headerlink" href="#mocking-facades" title="Permalink to this headline">¶</a></h3>
<p>When testing, you may often want to mock a call to a Laravel <a class="reference external" href="/docs/{{version}}/facades">facade</a>. For example, consider the following controller action:</p>
<pre class="literal-block">
&lt;?php

namespace App\Http\Controllers;

use Cache;
use Illuminate\Routing\Controller;

class UserController extends Controller
{
    /**
     * Show a list of all users of the application.
     *
     * &#64;return Response
     */
    public function index()
    {
        $value = Cache::get('key');

        //
    }
}
</pre>
<p>We can mock the call to the <code class="docutils literal"><span class="pre">Cache</span></code> facade by using the <code class="docutils literal"><span class="pre">shouldReceive</span></code> method, which will return an instance of a <a class="reference external" href="https://github.com/padraic/mockery">Mockery</a> mock. Since facades are actually resolved and managed by the Laravel <a class="reference external" href="/docs/{{version}}/container">service container</a>, they have much more testability than a typical static class. For example, let&#8217;s mock our call to the <code class="docutils literal"><span class="pre">Cache</span></code> facade:</p>
<pre class="literal-block">
&lt;?php

class FooTest extends TestCase
{
    public function testGetIndex()
    {
        Cache::shouldReceive('get')
                    -&gt;once()
                    -&gt;with('key')
                    -&gt;andReturn('value');

        $this-&gt;visit('/users')-&gt;see('value');
    }
}
</pre>
<blockquote>
<div><strong>Note:</strong> You should not mock the <code class="docutils literal"><span class="pre">Request</span></code> facade. Instead, pass the input you desire into the HTTP helper methods such as <code class="docutils literal"><span class="pre">call</span></code> and <code class="docutils literal"><span class="pre">post</span></code> when running your test.</div></blockquote>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, The Weezqyd.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>