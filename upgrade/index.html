<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Upgrade - Laravel 5.4 Official Documentation</title>
      
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Laravel 5.4 Official Documentation">
    <meta property="og:image" content="None/../">
    <meta name="apple-mobile-web-app-title" content="Laravel 5.4 Official Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-teal palette-accent-green">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Upgrade
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="/" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Laravel 5.4 Official Documentation
          <span class="version">
            
          </span>
        </strong>
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Apis" href="../apis/">
      Apis
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Artisan" href="../artisan/">
      Artisan
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Authentication" href="../authentication/">
      Authentication
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Authorization" href="../authorization/">
      Authorization
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Billing" href="../billing/">
      Billing
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Blade" href="../blade/">
      Blade
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Broadcasting" href="../broadcasting/">
      Broadcasting
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Cache" href="../cache/">
      Cache
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Collections" href="../collections/">
      Collections
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Configuration" href="../configuration/">
      Configuration
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Container" href="../container/">
      Container
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Contracts" href="../contracts/">
      Contracts
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Contributing" href="../contributing/">
      Contributing
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Contributions" href="../contributions/">
      Contributions
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Controllers" href="../controllers/">
      Controllers
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Csrf" href="../csrf/">
      Csrf
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Database testing" href="../database-testing/">
      Database testing
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Database" href="../database/">
      Database
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Documentation" href="../documentation/">
      Documentation
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Dusk" href="../dusk/">
      Dusk
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Eloquent collections" href="../eloquent-collections/">
      Eloquent collections
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Eloquent mutators" href="../eloquent-mutators/">
      Eloquent mutators
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Eloquent relationships" href="../eloquent-relationships/">
      Eloquent relationships
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Eloquent serialization" href="../eloquent-serialization/">
      Eloquent serialization
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Eloquent" href="../eloquent/">
      Eloquent
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Encryption" href="../encryption/">
      Encryption
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Envoy" href="../envoy/">
      Envoy
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Errors" href="../errors/">
      Errors
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Events" href="../events/">
      Events
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Facades" href="../facades/">
      Facades
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Filesystem" href="../filesystem/">
      Filesystem
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Frontend" href="../frontend/">
      Frontend
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Hashing" href="../hashing/">
      Hashing
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Helpers" href="../helpers/">
      Helpers
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Homestead" href="../homestead/">
      Homestead
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Http tests" href="../http-tests/">
      Http tests
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Installation" href="../installation/">
      Installation
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="License" href="../license/">
      License
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Lifecycle" href="../lifecycle/">
      Lifecycle
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Localization" href="../localization/">
      Localization
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Mail" href="../mail/">
      Mail
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Middleware" href="../middleware/">
      Middleware
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Migrations" href="../migrations/">
      Migrations
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Mix" href="../mix/">
      Mix
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Mocking" href="../mocking/">
      Mocking
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Notifications" href="../notifications/">
      Notifications
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Packages" href="../packages/">
      Packages
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Pagination" href="../pagination/">
      Pagination
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Passport" href="../passport/">
      Passport
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Passwords" href="../passwords/">
      Passwords
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Providers" href="../providers/">
      Providers
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Queries" href="../queries/">
      Queries
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Queues" href="../queues/">
      Queues
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Redirects" href="../redirects/">
      Redirects
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Redis" href="../redis/">
      Redis
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Releases" href="../releases/">
      Releases
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Requests" href="../requests/">
      Requests
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Responses" href="../responses/">
      Responses
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Routing" href="../routing/">
      Routing
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Scheduling" href="../scheduling/">
      Scheduling
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Scout" href="../scout/">
      Scout
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Seeding" href="../seeding/">
      Seeding
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Session" href="../session/">
      Session
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Structure" href="../structure/">
      Structure
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Testing" href="../testing/">
      Testing
    </a>
    
  </li>

          
            
  <li>
    <a class="current" title="Upgrade" href="./">
      Upgrade
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Upgrading To 5.4.0 From 5.3" href="#upgrading-to-540-from-53">
                Upgrading To 5.4.0 From 5.3
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            
  <li>
    <a class="" title="Valet" href="../valet/">
      Valet
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Validation" href="../validation/">
      Validation
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Views" href="../views/">
      Views
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="upgrade-guide">Upgrade Guide</h1>
<ul>
<li><a href="#upgrade-5.4.0">Upgrading To 5.4.0 From 5.3</a></li>
</ul>
<p><a name="upgrade-5.4.0"></a></p>
<h2 id="upgrading-to-540-from-53">Upgrading To 5.4.0 From 5.3</h2>
<h4 id="estimated-upgrade-time-1-2-hours">Estimated Upgrade Time: 1-2 Hours</h4>
<blockquote>
<p>{note} We attempt to document every possible breaking change. Since some of these breaking changes are in obscure parts of the framework only a portion of these changes may actually affect your application.</p>
</blockquote>
<h3 id="updating-dependencies">Updating Dependencies</h3>
<p>Update your <code>laravel/framework</code> dependency to <code>5.4.*</code> in your <code>composer.json</code> file. In addition, you should update your <code>phpunit/phpunit</code> dependency to <code>~5.7</code>.</p>
<h4 id="removing-compiled-services-file">Removing Compiled Services File</h4>
<p>If it exists, you may delete the <code>bootstrap/cache/compiled.php</code> file. It is no longer used by the framework.</p>
<h4 id="flushing-the-cache">Flushing The Cache</h4>
<p>After upgrading all packages, you should run <code>php artisan view:clear</code> to avoid Blade errors related to the removal of <code>Illuminate\View\Factory::getFirstLoop()</code>. In addition, you may need to run <code>php artisan route:clear</code> to flush the route cache.</p>
<h4 id="laravel-cashier">Laravel Cashier</h4>
<p>Laravel Cashier is already compatible with Laravel 5.4.</p>
<h4 id="laravel-passport">Laravel Passport</h4>
<p>Laravel Passport <code>2.0.0</code> has been released to provide compatibility with Laravel 5.4 and the <a href="https://github.com/mzabriskie/axios">Axios</a> JavaScript library. If you are upgrading from Laravel 5.3 and using the pre-built Passport Vue components, you should make sure the Axios library is globally available to your application as <code>axios</code>.</p>
<h4 id="laravel-scout">Laravel Scout</h4>
<p>Laravel Scout <code>3.0.0</code> has been released to provide compatibility with Laravel 5.4.</p>
<h4 id="laravel-socialite">Laravel Socialite</h4>
<p>Laravel Socialite <code>3.0.0</code> has been released to provide compatibility with Laravel 5.4.</p>
<h4 id="laravel-tinker">Laravel Tinker</h4>
<p>In order to continue using the <code>tinker</code> Artisan command, you should also install the <code>laravel/tinker</code> package:</p>
<div class="codehilite"><pre><span></span>composer require laravel/tinker
</pre></div>


<p>Once the package has been installed, you should add <code>Laravel\Tinker\TinkerServiceProvider::class</code> to the <code>providers</code> array in your <code>config/app.php</code> configuration file.</p>
<h4 id="guzzle">Guzzle</h4>
<p>Laravel 5.4 requires Guzzle 6.0 or greater.</p>
<h3 id="authorization">Authorization</h3>
<h4 id="the-getpolicyfor-method">The <code>getPolicyFor</code> Method</h4>
<p>Previous, when calling the <code>Gate::getPolicyFor($class)</code> method, an exception was thrown if no policy could be found. Now, the method will return <code>null</code> if no policy is found for the given class. If you call this method directly, make sure you refactor your code to check for <code>null</code>:</p>
<div class="codehilite"><pre><span></span><span class="x">$policy = Gate::getPolicyFor($class);</span>

<span class="x">if ($policy) {</span>
<span class="x">    // code that was previously in the try block</span>
<span class="x">} else {</span>
<span class="x">    // code that was previously in the catch block</span>
<span class="x">}</span>
</pre></div>


<h3 id="blade">Blade</h3>
<h4 id="section-escaping"><code>@section</code> Escaping</h4>
<p>In Laravel 5.4, inline content passed to a section is automatically escaped:</p>
<div class="codehilite"><pre><span></span>@section(&#39;title&#39;, $content)
</pre></div>


<p>If you would like to render unescaped content in a section, you must declare the section using the traditional "long form" style:</p>
<div class="codehilite"><pre><span></span>@section(&#39;title&#39;)
    {!! $content !!}
@stop
</pre></div>


<h3 id="bootstrappers">Bootstrappers</h3>
<p>If you are manually overriding the <code>$bootstrappers</code> array on your HTTP or Console kernel, you should rename the <code>DetectEnvironment</code> entry to <code>LoadEnvironmentVariables</code>.</p>
<h3 id="broadcasting">Broadcasting</h3>
<h4 id="channel-model-binding">Channel Model Binding</h4>
<p>When defining channel name placeholders in Laravel 5.3, the <code>*</code> character is used. In Laravel 5.4, you should define these placeholders using <code>{foo}</code> style placeholders, like routes:</p>
<div class="codehilite"><pre><span></span>Broadcast::channel(&#39;App.User.{userId}&#39;, function ($user, $userId) {
    return (int) $user-&gt;id === (int) $userId;
});
</pre></div>


<h3 id="collections">Collections</h3>
<h4 id="the-every-method">The <code>every</code> Method</h4>
<p>The behavior of the <code>every</code> method has been moved to the <code>nth</code> method to match the method name defined by Lodash.</p>
<h4 id="the-random-method">The <code>random</code> Method</h4>
<p>Calling <code>$collection-&gt;random(1)</code> will now return a new collection instance with one item. Previously, this would return a single object. This method will only return a single object if no arguments are supplied.</p>
<h3 id="container">Container</h3>
<h4 id="aliasing-via-bind-instance">Aliasing Via <code>bind</code> / <code>instance</code></h4>
<p>In previous Laravel releases, you could pass an array as the first parameter to the <code>bind</code> or <code>instance</code> methods to register an alias:</p>
<div class="codehilite"><pre><span></span>$container-&gt;bind([&#39;foo&#39; =&gt; FooContract::class], function () {
    return &#39;foo&#39;;
});
</pre></div>


<p>However, this behavior has been removed in Laravel 5.4. To register an alias, you should now use the <code>alias</code> method:</p>
<div class="codehilite"><pre><span></span><span class="o">$</span><span class="nt">container-</span><span class="o">&gt;</span><span class="nt">alias</span><span class="o">(</span><span class="nt">FooContract</span><span class="p">::</span><span class="nd">class</span><span class="o">,</span> <span class="s1">&#39;foo&#39;</span><span class="o">);</span>
</pre></div>


<h4 id="binding-classes-with-leading-slashes">Binding Classes With Leading Slashes</h4>
<p>Binding classes into the container with leading slashes is no longer supported. This feature required a significant amount of string formatting calls to be made within the container. Instead, simply register your bindings without a leading slash:</p>
<div class="codehilite"><pre><span></span>$container-&gt;bind(&#39;Class\Name&#39;, function () {
    //
});

$container-&gt;bind(ClassName::class, function () {
    //
});
</pre></div>


<h4 id="make-method-parameters"><code>make</code> Method Parameters</h4>
<p>The container's <code>make</code> method no longer accepts a second array of parameters. This feature typically indicates a code smell. Typically, you can always construct the object in another way that is more intuitive.</p>
<h4 id="resolving-callbacks">Resolving Callbacks</h4>
<p>The container's <code>resolving</code> and <code>afterResolving</code> method now must be provided a class name or binding key as the first argument to the method:</p>
<div class="codehilite"><pre><span></span>$container-&gt;resolving(&#39;Class\Name&#39;, function ($instance) {
    //
});

$container-&gt;afterResolving(&#39;Class\Name&#39;, function ($instance) {
    //
});
</pre></div>


<h4 id="share-method-removed"><code>share</code> Method Removed</h4>
<p>The <code>share</code> method has been removed from the container. This was a legacy method that has not been documented in several years. If you are using this method, you should begin using the <code>singleton</code> method instead:</p>
<div class="codehilite"><pre><span></span>$container-&gt;singleton(&#39;foo&#39;, function () {
    return &#39;foo&#39;;
});
</pre></div>


<h3 id="console">Console</h3>
<h4 id="the-illuminateconsoleappnamespacedetectortrait-trait">The <code>Illuminate\Console\AppNamespaceDetectorTrait</code> Trait</h4>
<p>If you are directly referencing the <code>Illuminate\Console\AppNamespaceDetectorTrait</code> trait, update your code to reference <code>Illuminate\Console\DetectsApplicationNamespace</code> instead.</p>
<h3 id="database">Database</h3>
<h4 id="custom-connections">Custom Connections</h4>
<p>If you were previously binding a service container binding for a <code>db.connection.{driver-name}</code> key in order to resolve a custom database connection instance, you should now use the <code>Illuminate\Database\Connection::resolverFor</code> method in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="codehilite"><pre><span></span>use Illuminate\Database\Connection;

Connection::resolverFor(&#39;driver-name&#39;, function ($connection, $database, $prefix, $config) {
    //
});
</pre></div>


<h4 id="fetch-mode">Fetch Mode</h4>
<p>Laravel no longer includes the ability to customize the PDO "fetch mode" from your configuration files. Instead, <code>PDO::FETCH_OBJ</code> is always used. If you will still like to customize the fetch mode for your application you may listen for the new <code>Illuminate\Database\Events\StatementPrepared</code> event:</p>
<div class="codehilite"><pre><span></span>Event::listen(StatementPrepared::class, function ($event) {
    $event-&gt;statement-&gt;setFetchMode(...);
});
</pre></div>


<h3 id="eloquent">Eloquent</h3>
<h4 id="date-casts">Date Casts</h4>
<p>The <code>date</code> cast now converts the column to a <code>Carbon</code> object and calls the <code>startOfDay</code> method on the object. If you would like to preserve the time portion of the date, you should use the <code>datetime</code> cast.</p>
<h4 id="foreign-key-conventions">Foreign Key Conventions</h4>
<p>If the foreign key is not explicitly specified when defining a relationship, Eloquent will now use the table name and primary key name for the related model to build the foreign key. For the vast majority of applications, this is not a change of behavior. For example:</p>
<div class="codehilite"><pre><span></span><span class="nt">public</span> <span class="nt">function</span> <span class="nt">user</span><span class="o">()</span>
<span class="p">{</span>
    <span class="err">return</span> <span class="err">$this-&gt;belongsTo(</span><span class="n">User</span><span class="p">:</span><span class="o">:</span><span class="n">class</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Just like previous Laravel releases, this relationship will typically use <code>user_id</code> as the foreign key. However, the behavior could be different from previous releases if you are overriding the <code>getKeyName</code> method of the <code>User</code> model. For example:</p>
<div class="codehilite"><pre><span></span>public function getKeyName()
{
    return &#39;key&#39;;
}
</pre></div>


<p>When this is the case, Laravel will now respect your customization and determine the foreign key column name is <code>user_key</code> instead of <code>user_id</code>.</p>
<h4 id="has-one-many-createmany">Has One / Many <code>createMany</code></h4>
<p>The <code>createMany</code> method of a <code>hasOne</code> or <code>hasMany</code> relationship now returns a collection object instead of an array.</p>
<h4 id="related-model-connections">Related Model Connections</h4>
<p>Related models will now use the same connection as the parent model. For example, if you execute a query like:</p>
<div class="codehilite"><pre><span></span><span class="nt">User</span><span class="p">::</span><span class="nd">on</span><span class="o">(</span><span class="s1">&#39;example&#39;</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">with</span><span class="o">(</span><span class="s1">&#39;posts&#39;</span><span class="o">);</span>
</pre></div>


<p>Eloquent will query the posts table on the <code>example</code> connection instead of the default database connection. If you want to read the <code>posts</code> relationship from the default connection, you should to explicitly set the model's connection to your application's default connection.</p>
<h4 id="the-create-forcecreate-methods">The <code>create</code> &amp; <code>forceCreate</code> Methods</h4>
<p>The <code>Model::create</code> &amp; <code>Model:: forceCreate</code> methods have been moved to the <code>Illuminate\Database\Eloquent\Builder</code> class in order to provide better support for creating models on multiple connections. However, if you are extending these methods in your own models, you will need to modify your implementation to call the <code>create</code> method on the builder. For example:</p>
<div class="codehilite"><pre><span></span><span class="nt">public</span> <span class="nt">static</span> <span class="nt">function</span> <span class="nt">create</span><span class="o">(</span><span class="nt">array</span> <span class="o">$</span><span class="nt">attributes</span> <span class="o">=</span> <span class="cp">[]</span><span class="o">)</span>
<span class="p">{</span>
    <span class="err">$model</span> <span class="err">=</span> <span class="n">static</span><span class="p">:</span><span class="o">:</span><span class="nf">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span><span class="err">$</span><span class="n">attributes</span><span class="p">);</span>

    <span class="err">//</span> <span class="err">...</span>

    <span class="err">return</span> <span class="err">$model</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h4 id="the-hydrate-method">The <code>hydrate</code> Method</h4>
<p>If you are currently passing a custom connection name to this method, you should now use the <code>on</code> method:</p>
<div class="codehilite"><pre><span></span><span class="nt">User</span><span class="p">::</span><span class="nd">on</span><span class="o">(</span><span class="s1">&#39;connection&#39;</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">hydrate</span><span class="o">($</span><span class="nt">records</span><span class="o">);</span>
</pre></div>


<h4 id="hydrateraw-method"><code>hydrateRaw</code> Method</h4>
<p>The <code>Model::hydrateRaw</code> method has been renamed to <code>fromQuery</code>. If you are passing a custom connection name to this method, you should now use the <code>on</code> method:</p>
<div class="codehilite"><pre><span></span><span class="nt">User</span><span class="p">::</span><span class="nd">on</span><span class="o">(</span><span class="s1">&#39;connection&#39;</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">fromQuery</span><span class="o">(</span><span class="s1">&#39;...&#39;</span><span class="o">);</span>
</pre></div>


<h4 id="the-wherekey-method">The <code>whereKey</code> Method</h4>
<p>The <code>whereKey($id)</code> method will now add a "where" clause for the given primary key value. Previously, this would fall into the dynamic "where" clause builder and add a "where" clause for the "key" column. If you used the <code>whereKey</code> method to dynamically add a condition for the <code>key</code> column you should now use <code>where('key', ...)</code> instead.</p>
<h4 id="the-factory-helper">The <code>factory</code> Helper</h4>
<p>Calling <code>factory(User::class, 1)-&gt;make()</code> or <code>factory(User::class, 1)-&gt;create()</code> will now return a collection with one item. Previously, this would return a single model. This method will only return a single model if the amount is not supplied.</p>
<h3 id="events">Events</h3>
<h4 id="contract-changes">Contract Changes</h4>
<p>If you are manually implementing the <code>Illuminate\Contracts\Events\Dispatcher</code> interface in your application or package, you should rename the <code>fire</code> method to <code>dispatch</code>.</p>
<h4 id="event-priority">Event Priority</h4>
<p>Support for event handler "priorities" has been removed. This undocumented feature typically indicates an abuse of the event feature. Instead, consider using a series of synchronous method calls. Alternatively, you may dispatch a new event from within the handler of another event in order to ensure that a given event's handler fires after an unrelated handler.</p>
<h4 id="wildcard-event-handler-signatures">Wildcard Event Handler Signatures</h4>
<p>Wildcard event handlers now receive the event name as their first argument and the array of event data as their second argument. The <code>Event::firing</code> method has been removed:</p>
<div class="codehilite"><pre><span></span>Event::listen(&#39;*&#39;, function ($eventName, array $data) {
    //
});
</pre></div>


<h4 id="the-kernelhandled-event">The <code>kernel.handled</code> Event</h4>
<p>The <code>kernel.handled</code> event is now an object based event using the <code>Illuminate\Foundation\Http\Events\RequestHandled</code> class.</p>
<h4 id="the-localechanged-event">The <code>locale.changed</code> Event</h4>
<p>The <code>locale.changed</code> event is now an object based event using the <code>Illuminate\Foundation\Events\LocaleUpdated</code> class.</p>
<h4 id="the-illuminatelog-event">The <code>illuminate.log</code> Event</h4>
<p>The <code>illuminate.log</code> event is now an object based event using the <code>Illuminate\Log\Events\MessageLogged</code> class.</p>
<h3 id="exceptions">Exceptions</h3>
<p>The <code>Illuminate\Http\Exception\HttpResponseException</code> has been renamed to <code>Illuminate\Http\Exceptions\HttpResponseException</code>. Note that <code>Exceptions</code> is now plural. Likewise, the <code>Illuminate\Http\Exception\PostTooLargeException</code> has been renamed to <code>Illuminate\Http\Exceptions\PostTooLargeException</code>.</p>
<h3 id="mail">Mail</h3>
<h4 id="classmethod-syntax"><code>Class@method</code> Syntax</h4>
<p>Sending mail using <code>Class@method</code> syntax is no longer supported. For example:</p>
<div class="codehilite"><pre><span></span><span class="nt">Mail</span><span class="p">::</span><span class="nd">send</span><span class="o">(</span><span class="s1">&#39;view.name&#39;</span><span class="o">,</span> <span class="o">$</span><span class="nt">data</span><span class="o">,</span> <span class="s1">&#39;Class@send&#39;</span><span class="o">);</span>
</pre></div>


<p>If you are sending mail in this way you should convert these calls to <a href="../docs/{{version}}/mail">mailables</a>.</p>
<h4 id="new-configuration-options">New Configuration Options</h4>
<p>In order to provide support for Laravel 5.4's new Markdown mail components, you should add the following block of configuration to the bottom of your <code>mail</code> configuration file:</p>
<div class="codehilite"><pre><span></span>&#39;markdown&#39; =&gt; [
    &#39;theme&#39; =&gt; &#39;default&#39;,

    &#39;paths&#39; =&gt; [
        resource_path(&#39;views/vendor/mail&#39;),
    ],
],
</pre></div>


<h4 id="queueing-mail-with-closures">Queueing Mail With Closures</h4>
<p>In order to queue mail, you now must use a <a href="../docs/{{version}}/mail">mailable</a>. Queuing mail using the <code>Mail::queue</code> and <code>Mail::later</code> methods no longer supports using Closures to configure the mail message. This feature required the use of special libraries to serialize Closures since PHP does not natively support this feature.</p>
<h3 id="redis">Redis</h3>
<h4 id="improved-clustering-support">Improved Clustering Support</h4>
<p>Laravel 5.4 introduces improved Redis cluster support. If you are using Redis clusters, you should place your cluster connections inside of a <code>clusters</code> configuration option in the Redis portion of your <code>config/database.php</code> configuration file:</p>
<div class="codehilite"><pre><span></span>&#39;redis&#39; =&gt; [

    &#39;client&#39; =&gt; &#39;predis&#39;,

    &#39;options&#39; =&gt; [
        &#39;cluster&#39; =&gt; &#39;redis&#39;,
    ],

    &#39;clusters&#39; =&gt; [
        &#39;default&#39; =&gt; [
            [
                &#39;host&#39; =&gt; env(&#39;REDIS_HOST&#39;, &#39;127.0.0.1&#39;),
                &#39;password&#39; =&gt; env(&#39;REDIS_PASSWORD&#39;, null),
                &#39;port&#39; =&gt; env(&#39;REDIS_PORT&#39;, 6379),
                &#39;database&#39; =&gt; 0,
            ],
        ],
    ],

],
</pre></div>


<h3 id="routing">Routing</h3>
<h4 id="post-size-middleware">Post Size Middleware</h4>
<p>The class <code>Illuminate\Foundation\Http\Middleware\VerifyPostSize</code> has been renamed to <code>Illuminate\Foundation\Http\Middleware\ValidatePostSize</code>.</p>
<h4 id="the-middleware-method">The <code>middleware</code> Method</h4>
<p>The <code>middleware</code> method of the <code>Illuminate\Routing\Router</code> class has been renamed to <code>aliasMiddleware()</code>. It is likely that most applications never call this method manually, as it is typically only called by the HTTP kernel to register route-level middleware defined in the <code>$routeMiddleware</code> array.</p>
<h4 id="route-methods"><code>Route</code> Methods</h4>
<p>The <code>getUri</code> method of the <code>Illuminate\Routing\Route</code> class has been removed. You should use the <code>uri</code> method instead.</p>
<p>The <code>getMethods</code> method of the <code>Illuminate\Routing\Route</code> class has been removed. You should use the <code>methods</code> method instead.</p>
<p>The <code>getParameter</code> method of the <code>Illuminate\Routing\Route</code> class has been removed. You should use the <code>parameter</code> method instead.</p>
<h3 id="sessions">Sessions</h3>
<h4 id="symfony-compatibility">Symfony Compatibility</h4>
<p>Laravel's session handlers no longer implements Symfony's <code>SessionInterface</code>. Implementing this interface required us to implement extraneous features that were not needed by the framework. Instead, a new <code>Illuminate\Contracts\Session\Session</code> interface has been defined and may be used instead. The following code changes should also be applied:</p>
<p>All calls to the <code>-&gt;set()</code> method should be changed to <code>-&gt;put()</code>. Typically, Laravel applications would never call the <code>set</code> method since it has never been documented within the Laravel documentation. However, it is included here out of caution.</p>
<p>All calls to the <code>-&gt;getToken()</code> method should be changed to <code>-&gt;token()</code>.</p>
<p>All calls to the <code>$request-&gt;setSession()</code> method should be changed to <code>setLaravelSession()</code>.</p>
<h3 id="testing">Testing</h3>
<p>Laravel 5.4's testing layer has been re-written to be simpler and lighter out of the box. If you would like to continue using the testing layer present in Laravel 5.3, you may install the <code>laravel/browser-kit-testing</code> <a href="https://github.com/laravel/browser-kit-testing">package</a> into your application. This package provides full compatibility with the Laravel 5.3 testing layer. In fact, you can run the Laravel 5.4 testing layer side-by-side with the Laravel 5.3 testing layer.</p>
<h4 id="running-laravel-53-54-tests-in-a-single-application">Running Laravel 5.3 &amp; 5.4 Tests In A Single Application</h4>
<p>Before getting started, you should add the <code>Tests</code> namespace to your <code>composer.json</code> file's <code>autoload-dev</code> block. This will allow Laravel to autoload any new tests you generate using the Laravel 5.4 test generators:</p>
<div class="codehilite"><pre><span></span>&quot;psr-4&quot;: {
    &quot;Tests\\&quot;: &quot;tests/&quot;
}
</pre></div>


<p>Next, install the <code>laravel/browser-kit-testing</code> package:</p>
<div class="codehilite"><pre><span></span>composer require laravel/browser-kit-testing
</pre></div>


<p>Once the package has been installed, create a copy of your <code>tests/TestCase.php</code> file and save it to your <code>tests</code> directory as <code>BrowserKitTestCase.php</code>. Then, modify the file to extend the <code>Laravel\BrowserKitTesting\TestCase</code> class. Once you have done this, you should have two base test classes in your <code>tests</code> directory: <code>TestCase.php</code> and <code>BrowserKitTestCase.php</code>. In order for your <code>BrowserKitTestCase</code> class to be properly loaded, you may need to add it to your <code>composer.json</code> file:</p>
<div class="codehilite"><pre><span></span>&quot;autoload-dev&quot;: {
    &quot;classmap&quot;: [
        &quot;tests/TestCase.php&quot;,
        &quot;tests/BrowserKitTestCase.php&quot;
    ]
},
</pre></div>


<p>Tests written on Laravel 5.3 will extend the <code>BrowserKitTestCase</code> class while any new tests that use the Laravel 5.4 testing layer will extend the <code>TestCase</code> class. Your <code>BrowserKitTestCase</code> class should look like the following:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Console\Kernel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\BrowserKitTesting\TestCase</span> <span class="k">as</span> <span class="nx">BaseTestCase</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">BrowserKitTestCase</span> <span class="k">extends</span> <span class="nx">BaseTestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The base URL of the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$baseUrl</span> <span class="o">=</span> <span class="s1">&#39;http://localhost&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Creates the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Foundation\Application</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$app</span> <span class="o">=</span> <span class="k">require</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../bootstrap/app.php&#39;</span><span class="p">;</span>

        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nx">Kernel</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">bootstrap</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$app</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Once you have created this class, make sure to update all of your tests to extend your new <code>BrowserKitTestCase</code> class. This will allow all of your tests written on Laravel 5.3 to continue running on Laravel 5.4. If you choose, you can slowly begin to port them over to the new <a href="../docs/5.4/http-tests">Laravel 5.4 test syntax</a> or <a href="../docs/5.4/dusk">Laravel Dusk</a>.</p>
<blockquote>
<p>{note} If you are writing new tests and want them to use the Laravel 5.4 testing layer, make sure to extend the <code>TestCase</code> class.</p>
</blockquote>
<h4 id="installing-dusk-in-an-upgraded-application">Installing Dusk In An Upgraded Application</h4>
<p>If you would like to install Laravel Dusk into an application that has been upgraded from Laravel 5.3, first install it via Composer:</p>
<div class="codehilite"><pre><span></span>composer require laravel/dusk
</pre></div>


<p>Next, you will need to create a <code>CreatesApplication</code> trait in your <code>tests</code> directory. This trait is responsible for creating fresh application instances for test cases. The trait should look like the following:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Console\Kernel</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">CreatesApplication</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Creates the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Foundation\Application</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$app</span> <span class="o">=</span> <span class="k">require</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../bootstrap/app.php&#39;</span><span class="p">;</span>

        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nx">Kernel</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">bootstrap</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$app</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<blockquote>
<p>{note} If you have namespaced your tests and are using the PSR-4 autoloading standard to load your <code>tests</code> directory, you should place the <code>CreatesApplication</code> trait under the appropriate namespace.</p>
</blockquote>
<p>Once you have completed these preparatory steps, you can follow the normal <a href="../docs/{{version}}/dusk#installation">Dusk installation instructions</a>.</p>
<h4 id="environment">Environment</h4>
<p>The Laravel 5.4 test class no longer manually forces <code>putenv('APP_ENV=testing')</code> for each test. Instead, the framework utilizes the <code>APP_ENV</code> variable from the loaded <code>.env</code> file.</p>
<h4 id="event-fake">Event Fake</h4>
<p>The <code>Event</code> fake's <code>assertFired</code> method should be updated to <code>assertDispatched</code>, and the <code>assertNotFired</code> method should be updated to <code>assertNotDispatched</code>. The method's signatures have not been changed.</p>
<h4 id="mail-fake">Mail Fake</h4>
<p>The <code>Mail</code> fake has been greatly simplified for the Laravel 5.4 release. Instead of using the <code>assertSentTo</code> method, you should now simply use the <code>assertSent</code> method and utilize the <code>hasTo</code>, <code>hasCc</code>, etc. helper methods within your callback:</p>
<div class="codehilite"><pre><span></span>Mail::assertSent(MailableName::class, function ($mailable) {
    return $mailable-&gt;hasTo(&#39;email@example.com&#39;);
});
</pre></div>


<h3 id="translation">Translation</h3>
<h4 id="inf-placeholder"><code>{Inf}</code> Placeholder</h4>
<p>If you are using the <code>{Inf}</code> placeholder for pluralizing your translation strings, you should update your translation strings to use the <code>*</code> character instead:</p>
<div class="codehilite"><pre><span></span>{0} First Message|{1,*} Second Message
</pre></div>


<h3 id="url-generation">URL Generation</h3>
<h4 id="the-forceschema-method">The <code>forceSchema</code> Method</h4>
<p>The <code>forceSchema</code> method of the <code>Illuminate\Routing\UrlGenerator</code> class has been renamed to <code>forceScheme</code>.</p>
<h3 id="validation">Validation</h3>
<h4 id="date-format-validation">Date Format Validation</h4>
<p>Date format validation is now more strict and supports the placeholders present within the documentation for the PHP <a href="http://php.net/manual/en/function.date.php">date function</a>. In previous releases of Laravel, the timezone placeholder <code>P</code> would accept all timezone formats; however, in Laravel 5.4 each timezone format has a unique placeholder as per the PHP documentation.</p>
<h4 id="method-names">Method Names</h4>
<p>The <code>addError</code> method has been renamed to <code>addFailure</code>. In addition, the <code>doReplacements</code> method has been renamed to <code>makeReplacements</code>. Typically, these changes will only be relevant if you are extending the <code>Validator</code> class.</p>
<h3 id="miscellaneous">Miscellaneous</h3>
<p>We also encourage you to view the changes in the <code>laravel/laravel</code> <a href="https://github.com/laravel/laravel">GitHub repository</a>. While many of these changes are not required, you may wish to keep these files in sync with your application. Some of these changes will be covered in this upgrade guide, but others, such as changes to configuration files or comments, will not be. You can easily view the changes with the <a href="https://github.com/laravel/laravel/compare/5.3...master">Github comparison tool</a> and choose which updates are important to you.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../testing/" title="Testing">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Testing
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../valet/" title="Valet">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Valet
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = '';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>